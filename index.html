




<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>Pseudowhizz - Online Pseudocode Interpreter</title>

    <link rel="stylesheet" href="codemirror-5.65.19/theme/darcula.css">
    <link rel="stylesheet" href="codemirror-5.65.19/theme/idea.css">
    
    <script src="codemirror-5.65.19/lib/codemirror.js"></script>
    <script src="codemirror-5.65.19/addon/edit/closebrackets.js"></script>



    <script src="codemirror-5.65.19/addon/fold/indent-fold.js"></script>
    <script src="codemirror-5.65.19/addon/fold/foldcode.js"></script>
    <script src="codemirror-5.65.19/addon/fold/foldgutter.js"></script>
    <script src="codemirror-5.65.19/addon/edit/matchbrackets.js"></script>

    <link rel="icon" href="Assets/Icon/favicon.ico">
    <link rel="icon" href="/favicon.ico">
    <meta property="og:image" content="https://pseudowhizz.org/public/Preview/preview.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta name="keywords" content="pseudowhizz, pseudocode, online pseudocode interpreter,online interpreter, interpreter, cie, igcse, coding, programming, cambridge international, gcse, computer science, cs, exam, 0478, computing, how to write pseudocode, pseudocode writer, pseudocode generator, pseudocode excecutor">
    <meta name="description" content="Pseudowhizz Online Pseudocode Interpreter - Designed just for GCSE students to easily write and excecute IGCSE standard pseudocode.">
    <meta property="og:title" content="Pseudowhizz Online Pseudocode Interpreter">
    <meta property="og:description" content="Pseudowhizz Online Pseudocode Interpreter - Designed just for GCSE students to easily write and excecute IGCSE standard pseudocode.">

    <link rel="stylesheet" href="codemirror-5.65.19/lib/codemirror.css">
    



    <link rel="stylesheet" href="style.css">



    <link rel="stylesheet" href="codemirror-5.65.19/addon/fold/foldgutter.css">

    <link rel="stylesheet" href="codemirror-5.65.19/addon/lint/lint.css">
    <script src="codemirror-5.65.19/addon/lint/lint.js"></script>


    <script type="text/javascript" src="lightMode.js" defer></script>


    <script src="codemirror-5.65.19/addon/hint/show-hint.js"></script>
    <link rel="stylesheet" href="codemirror-5.65.19/addon/hint/show-hint.css">


    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9837178944354824"
        crossorigin="anonymous">
    </script>

    <script type="application/ld+json">
    {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Pseudowhizz",
    "url": "https://pseudowhizz.org/",
    "description": "Pseudowhizz Online Pseudocode Interpreter - Designed just for GCSE students to easily write and excecute IGCSE standard pseudocode.",
    "logo": "https://pseudowhizz.org/favicon.ico"
    }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>
    
</head>
<body id="Home">

    <nav>

        <logo-wrapper>
            <a id="logo-svg" href="#"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0,0,348.09257,355.84254"><g transform="translate(-66.07874,-2.07873)"><g data-paper-data="{&quot;isPaintingLayer&quot;:true}" stroke="none" stroke-width="1" stroke-linecap="square" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" style="mix-blend-mode: normal"><path d="M66.07874,35.15509v0c0,-18.26756 14.80878,-33.07635 33.07636,-33.07635h281.68982c8.7724,0 17.18548,3.48481 23.38849,9.68784c6.20306,6.20302 9.68786,14.61612 9.68786,23.38852v281.68982c0,18.26758 -14.80877,33.07635 -33.07635,33.07635h-281.68982c-18.26758,0 -33.07636,-14.80877 -33.07636,-33.07635z" fill="var(--accent)" fill-rule="evenodd"/><path d="M414.17131,349.89106h-269.25986v-220.96858c0,-11.72117 4.65185,-22.96229 12.93216,-31.25041c8.2803,-8.28815 19.51083,-12.94436 31.22098,-12.94436v0h225.10672z" fill="currentColor" fill-rule="evenodd"/><path d="M169.66928,128.44095h244.25198v229.48032h-244.25198z" fill-opacity="0" fill="currentColor" fill-rule="evenodd"/><path d="M273.13806,238.15344c0,6.125 -1.47397,11.61459 -4.4219,16.46875c-2.94792,4.84375 -6.99479,8.625 -12.14062,11.34375c-5.13541,2.71875 -10.76563,4.07813 -16.89063,4.07813h-20.98437v17.67188h21.15625v16.125h-50.78125v-16.125h13.6875v-66.90625h-13.51562v-16.10937h45.75c12.02084,0 21.38021,2.94791 28.07813,8.84375c6.70835,5.88541 10.06253,14.08854 10.06253,24.60938zM257.18491,237.62219c0,-5.08334 -1.88021,-9.15625 -5.64063,-12.21875c-3.75,-3.0625 -9.26562,-4.59375 -16.54687,-4.59375h-16.29687v33.10938h18.03125c13.63541,0 20.45313,-5.43229 20.45313,-16.29687zM322.00995,220.80969h-15.9375l6.0625,49.57813l17.32813,-47.3125h11.4375l17.51563,46.96875l5.89063,-49.23437h-16.125v-16.10937h39.51563v16.10938h-8.14062l-11.26562,83.03125h-13.51562l-19.9375,-52l-19.59375,52h-13.6875l-11.09375,-83.03125h-8.14062v-16.10937h39.6875z" fill="var(--accent)" fill-rule="nonzero"/></g></g></svg></a>
            <div id="svg-title"><a href="#">//Pseudowhizz</a></div>
        </logo-wrapper>

        <ul id="navBar">
            <li><a href="#">Editor</a></li>
            <li><a href='/about' target='_blank'>About</a></li>

            <li><a href='/contact' target='_blank'>Contact</a></li>

            <li><a href='/donate' target='_blank'>Donate</a></li>
            <li><a href='/pps' target='_blank'>PPQs</a></li>


            
        </ul>




        <div id="mobile-navbox" tabindex="0">

            <ul id="mobile-nav-list">
                <li><a class="current-tab" href="#">Editor</a></li>
                <li><a href='/about' target='_blank'>About</a></li>

                <li><a href='/contact' target='_blank'>Contact</a></li>

                <li><a href='/donate' target='_blank'>Donate</a></li>
                <li><a href='/pps' target='_blank'>Past Paper Solutions</a></li>
                <li id="settings-mbl-li"><a id="settings-mbl" class="current-tab" href='#'>Settings</a></li>
                <li id="share-mbl-li"><a id="share-mbl" class="current-tab" href="#">Share</a></li>
                <li id="fullscreen-mbl-li"><a id="fullscreen-mbl" class="current-tab" href="#">Enter fullscreen</a></li>
                
            </ul>
            <div class="ham">
                <span></span>
                <span></span>
                <span></span>
            </div>

        </div>
    </nav>

    <editor-main>
        <div class="ad-wrapper">
            <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-9837178944354824"
            data-ad-slot="4592956241"
            data-ad-format="auto"
            data-full-width-responsive="true">
            </ins>
            <script>
                if(window.matchMedia("(min-width: 1400px)").matches){
                    (adsbygoogle = window.adsbygoogle || []).push({});
                }

            </script>
        </div>

        <div id="underlay">
            <editornav>
                <ul id="menu">
                    <li><input class="editor-btn" type="button" id="saveBtn" title="Download (Ctrl+S)" value="Download"></li>
                    <li><input class="editor-btn" type="button" id="loadBtn" title="Upload (Ctrl+U)" value="Upload"></li>
                    <li><input class="editor-btn" type="button" id="runBtn" title="Run (Ctrl+Enter)" value="Run"></li>
                    <li><input class="editor-btn" type="button" id="clearBtn" title="Clear" value="Clear"></li>
                    

                        
                </ul>
                <a id="hiddenDownload" style="display:none;"></a>

                <div id="menu-right">
                
                    <div id="theme-toggle-container" title="Change theme">
                        <div id="theme-toggle-outline">
                            <input type="checkbox" id="theme-toggle" hidden>
                            <label for="theme-toggle">

                            <ul id="theme-toggle-svg-container">
                                <li><svg version="1.0" class="sun"  viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 3V4M12 20V21M4 12H3M6.31412 6.31412L5.5 5.5M17.6859 6.31412L18.5 5.5M6.31412 17.69L5.5 18.5001M17.6859 17.69L18.5 18.5001M21 12H20M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12Z" stroke="currentColour" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg></li>

                                <li><svg version="1.0" class="moon"  viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3.32031 11.6835C3.32031 16.6541 7.34975 20.6835 12.3203 20.6835C16.1075 20.6835 19.3483 18.3443 20.6768 15.032C19.6402 15.4486 18.5059 15.6834 17.3203 15.6834C12.3497 15.6834 8.32031 11.654 8.32031 6.68342C8.32031 5.50338 8.55165 4.36259 8.96453 3.32996C5.65605 4.66028 3.32031 7.89912 3.32031 11.6835Z" stroke="currentColour" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg></li>
                            </ul>
                            </label>
                            <div id="toggle-highlight"></div>
                        </div>
                    </div>

                    <div id="widescreen-only">
                        <div class="btn-any" id="settings" title="Settings"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 416 432"><path fill="currentColor" d="m366 237l45 35q7 6 3 14l-43 74q-4 8-13 4l-53-21q-18 13-36 21l-8 56q-1 9-11 9h-85q-9 0-11-9l-8-56q-19-8-36-21l-53 21q-9 3-13-4L1 286q-4-8 3-14l45-35q-1-12-1-21t1-21L4 160q-7-6-3-14l43-74q5-8 13-4l53 21q18-13 36-21l8-56q2-9 11-9h85q10 0 11 9l8 56q19 8 36 21l53-21q9-3 13 4l43 74q4 8-3 14l-45 35q2 12 2 21t-2 21zm-158.5 54q30.5 0 52.5-22t22-53t-22-53t-52.5-22t-52.5 22t-22 53t22 53t52.5 22z"/></svg>
                        </div>

                        <div class="btn-any" id="share-btn" title="Share"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24"><path fill="currentColor" d="M15.991 1.035a4 4 0 1 1-.855 6.267l-6.28 3.626a4.007 4.007 0 0 1 0 2.144l6.28 3.626a4.002 4.002 0 0 1 6.32 4.803a4 4 0 0 1-7.32-3.07l-6.28-3.627a4.002 4.002 0 1 1 0-5.608l6.28-3.626a4.002 4.002 0 0 1 1.855-4.535ZM19.723 3.5a2 2 0 1 0-3.464 2a2 2 0 0 0 3.464-2ZM3.071 12.527a2.002 2.002 0 0 0 2.93 1.204a2 2 0 1 0-2.93-1.204Zm15.92 5.242a2 2 0 1 0-2 3.464a2 2 0 0 0 2-3.464Z"/></svg>
                        </div>

                        <div class="btn-any" id="fullscreen-btn" title="Enter fullscreen">

                            <div class="fs-col">
                                <div class="fs-row">
                                    <span class="fs-angle" id="fs-ang-tl"></span>
                                    <span class="fs-angle" id="fs-ang-tr"></span>
                                </div>
                                <div class="fs-row">
                                    <span class="fs-angle" id="fs-ang-bl"></span>
                                    <span class="fs-angle" id="fs-ang-br"></span>
                                </div>
                            </div>

                            <div class="efs-col">
                                <div class="efs-row">
                                    <span class="fs-angle" id="efs-ang-tl"></span>
                                    <span class="fs-angle" id="efs-ang-tr"></span>
                                </div>
                                <div class="efs-row">
                                    <span class="fs-angle" id="efs-ang-bl"></span>
                                    <span class="fs-angle" id="efs-ang-br"></span>
                                </div>
                            </div>
                            

                        </div>
                    </div>

                    
                </div>




            </editornav>
            <div id="editor-container">


               

                <h3 id="editorTitle">Main.pseudo</h3>
                <div id="topBar">


                    <div id="tabs">
                        <ul>
                            <li class="Main.pseudo def" id="tabLink" onclick="
                                

                                document.getElementById('mini-map-scroll').style.top = '0px';


                                    


                              
                                IsolateTabSelection(this);">
                                <a>Main.pseudo</a>
                                
                                <div id="underline"></div>
                            </li>
                            <li class="Sample.txt" id="tabLink" onclick="
                            
                                document.getElementById('mini-map-scroll').style.top = '0px';
                                
                                
                                IsolateTabSelection(this);">
                                    <a>Sample.txt</a>
                                    <button onclick="
                                        event.stopPropagation();
                                        removeFile(this);
                                            ">x
                                    </button>
                                        
                                    
                                    <div id="underline"></div>
                                
                            </li>




                            <li>
                                
                                <button id="addFiles" onclick="
                                if(!testFileMemory()){
                                    
                                    alert(`Maxium ${maxFiles} files can be opened at once!`);
                                }
                                else{
                                    let fileName = prompt('New file name: ');



                                    if(fileName && !fileName.startsWith('null') && fileName !== null){



                                        createNewFile(fileName, '');
                                    }
                                }
                                "><svg xmlns="http://www.w3.org/2000/svg"
                                    width="24" height="24" viewBox="0 0 14 14">
                                    <path fill="currentColor"
                                            stroke="currentColor"
                                            stroke-width="2"
                                            d="M8 1a1 1 0 0 0-2 0v5H1a1 1 0 0 0 0 2h5v5a1 1 0 1 0 2 0V8h5a1 1 0 1 0 0-2H8z"/>
                                    </svg>

                                </button>
                        
                            </li>
                        </ul>

                    </div>


                        
                </div>

                <div id="editor-box">

                    <div id="editor-body">
                        <textarea id="sourceCode" ></textarea>

                        <div id="mini-map-collumn">
                            <div id="mini-map-scroll"></div>
                            <div id="minimap-vertical-wrapper">
                                <div id="mini-map-content"></div>
                            </div>
                        </div>
                        
                    </div>

                    

                    <ul id="editor-position-table">
                        <li class="ediPosPlate">Ln:</li>
                        <li id="Ln">1</li>
                        <li class="ediPosPlate">,</li>
                        <li class="ediPosPlate">Col:</li>
                        <li id="Col">1</li>
                        <li id="charsSelected" class="ediPosPlate"></li>
                    </ul>
                </div>

                <br>

                <div id="editor-footer">

                    <div id="console-options">
                        <div title="Copy to clipboard" id="copy-console" class="console-btn"><svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" viewBox="0 0 24 20"><path fill="currentColor" d="M19.53 8L14 2.47a.75.75 0 0 0-.53-.22H11A2.75 2.75 0 0 0 8.25 5v1.25H7A2.75 2.75 0 0 0 4.25 9v10A2.75 2.75 0 0 0 7 21.75h7A2.75 2.75 0 0 0 16.75 19v-1.25H17A2.75 2.75 0 0 0 19.75 15V8.5a.75.75 0 0 0-.22-.5Zm-5.28-3.19l2.94 2.94h-2.94Zm1 14.19A1.25 1.25 0 0 1 14 20.25H7A1.25 1.25 0 0 1 5.75 19V9A1.25 1.25 0 0 1 7 7.75h1.25V15A2.75 2.75 0 0 0 11 17.75h4.25ZM17 16.25h-6A1.25 1.25 0 0 1 9.75 15V5A1.25 1.25 0 0 1 11 3.75h1.75V8.5a.76.76 0 0 0 .75.75h4.75V15A1.25 1.25 0 0 1 17 16.25Z"/></svg></div>
                        <div title="Clear" id="clear-console" class="console-btn"><svg xmlns="http://www.w3.org/2000/svg" stroke-width='1' width="20" height="20" viewBox="0 0 26 26"><path fill="currentColor" d="m14.03 1.889l9.657 9.657l-8.345 8.345l-.27.27H20v2H6.747l-3.666-3.666a4 4 0 0 1 0-5.657l10.95-10.95Zm.322 16.163l6.507-6.506l-6.829-6.829l-6.828 6.829l6.828 6.828l.32-.323l.002.001ZM5.788 12.96l-1.293 1.293a2 2 0 0 0 0 2.828l3.08 3.08h4.68l.366-.368l-6.833-6.833Z"/></svg></div>
                        <div title="Download" id="download-console" class="console-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 18 18"><path fill="currentColor" fill-rule="evenodd" d="M11.78 7.159a.75.75 0 0 0-1.06 0l-1.97 1.97V1.75a.75.75 0 0 0-1.5 0v7.379l-1.97-1.97a.75.75 0 0 0-1.06 1.06l3.25 3.25L8 12l.53-.53l3.25-3.25a.75.75 0 0 0 0-1.061ZM2.5 9.75a.75.75 0 0 0-1.5 0V13a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V9.75a.75.75 0 0 0-1.5 0V13a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V9.75Z" clip-rule="evenodd"/></svg></div>
                    </div>

                    <div id="Output">
                       
                        <div id="progress-bar"></div>

                        <div id="console-body">
                            <div id="console-content"></div>
                            <div id="console-ext"></div>
                        </div>

                        
                    </div>
                </div>
                
            
            </div>
            <br>

            <div id="more-tools-pannel">
                <h3>More Tools</h3>

                <ul id="more-tools">
                    <li><button title="View Tokens (Lexical Analysis Stage)" class="more-tools-btn" id="tokens-btn"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 15 15"><path fill="currentColor" fill-rule="evenodd" d="M4.5 2a2.5 2.5 0 1 0 0 5a2.5 2.5 0 0 0 0-5ZM3 4.5a1.5 1.5 0 1 1 3 0a1.5 1.5 0 0 1-3 0ZM10.5 2a2.5 2.5 0 1 0 0 5a2.5 2.5 0 0 0 0-5ZM9 4.5a1.5 1.5 0 1 1 3 0a1.5 1.5 0 0 1-3 0Zm-7 6a2.5 2.5 0 1 1 5 0a2.5 2.5 0 0 1-5 0ZM4.5 9a1.5 1.5 0 1 0 0 3a1.5 1.5 0 0 0 0-3Zm6-1a2.5 2.5 0 1 0 0 5a2.5 2.5 0 0 0 0-5ZM9 10.5a1.5 1.5 0 1 1 3 0a1.5 1.5 0 0 1-3 0Z" clip-rule="evenodd"/></svg></button></li>
                    <li><button title="View AST (Abstract Syntax Tree)" class="more-tools-btn" id="ast-btn"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24"><path fill="currentColor" d="M10 2a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H8v2h5V9a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1h-6a1 1 0 0 1-1-1v-1H8v6h5v-1a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1h-6a1 1 0 0 1-1-1v-1H7a1 1 0 0 1-1-1V8H4a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h6Zm9 16h-4v2h4v-2Zm0-8h-4v2h4v-2ZM9 4H5v2h4V4Z"/></svg></button></li>
                    <li><button title="View Python translation [BETA]" class="more-tools-btn" id="python-btn"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24"><path fill="currentColor" d="m14.25.18l.9.2l.73.26l.59.3l.45.32l.34.34l.25.34l.16.33l.1.3l.04.26l.02.2l-.01.13V8.5l-.05.63l-.13.55l-.21.46l-.26.38l-.3.31l-.33.25l-.35.19l-.35.14l-.33.1l-.3.07l-.26.04l-.21.02H8.77l-.69.05l-.59.14l-.5.22l-.41.27l-.33.32l-.27.35l-.2.36l-.15.37l-.1.35l-.07.32l-.04.27l-.02.21v3.06H3.17l-.21-.03l-.28-.07l-.32-.12l-.35-.18l-.36-.26l-.36-.36l-.35-.46l-.32-.59l-.28-.73l-.21-.88l-.14-1.05l-.05-1.23l.06-1.22l.16-1.04l.24-.87l.32-.71l.36-.57l.4-.44l.42-.33l.42-.24l.4-.16l.36-.1l.32-.05l.24-.01h.16l.06.01h8.16v-.83H6.18l-.01-2.75l-.02-.37l.05-.34l.11-.31l.17-.28l.25-.26l.31-.23l.38-.2l.44-.18l.51-.15l.58-.12l.64-.1l.71-.06l.77-.04l.84-.02l1.27.05zm-6.3 1.98l-.23.33l-.08.41l.08.41l.23.34l.33.22l.41.09l.41-.09l.33-.22l.23-.34l.08-.41l-.08-.41l-.23-.33l-.33-.22l-.41-.09l-.41.09zm13.09 3.95l.28.06l.32.12l.35.18l.36.27l.36.35l.35.47l.32.59l.28.73l.21.88l.14 1.04l.05 1.23l-.06 1.23l-.16 1.04l-.24.86l-.32.71l-.36.57l-.4.45l-.42.33l-.42.24l-.4.16l-.36.09l-.32.05l-.24.02l-.16-.01h-8.22v.82h5.84l.01 2.76l.02.36l-.05.34l-.11.31l-.17.29l-.25.25l-.31.24l-.38.2l-.44.17l-.51.15l-.58.13l-.64.09l-.71.07l-.77.04l-.84.01l-1.27-.04l-1.07-.14l-.9-.2l-.73-.25l-.59-.3l-.45-.33l-.34-.34l-.25-.34l-.16-.33l-.1-.3l-.04-.25l-.02-.2l.01-.13v-5.34l.05-.64l.13-.54l.21-.46l.26-.38l.3-.32l.33-.24l.35-.2l.35-.14l.33-.1l.3-.06l.26-.04l.21-.02l.13-.01h5.84l.69-.05l.59-.14l.5-.21l.41-.28l.33-.32l.27-.35l.2-.36l.15-.36l.1-.35l.07-.32l.04-.28l.02-.21V6.07h2.09l.14.01zm-6.47 14.25l-.23.33l-.08.41l.08.41l.23.33l.33.23l.41.08l.41-.08l.33-.23l.23-.33l.08-.41l-.08-.41l-.23-.33l-.33-.23l-.41-.08l-.41.08z"/></svg></button></li>
                    <li><button title="View JS translation [BETA]" class="more-tools-btn" id="js-btn"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 256 256"><g fill="none"><rect width="256" height="256" fill="currentColor" rx="60"/><path fill="var(--editor-bg)" d="m67.312 213.932l19.59-11.856c3.78 6.701 7.218 12.371 15.465 12.371c7.905 0 12.889-3.092 12.889-15.12v-81.798h24.058v82.138c0 24.917-14.606 36.259-35.916 36.259c-19.245 0-30.416-9.967-36.087-21.996m85.07-2.576l19.588-11.341c5.157 8.421 11.859 14.607 23.715 14.607c9.969 0 16.325-4.984 16.325-11.858c0-8.248-6.53-11.17-17.528-15.98l-6.013-2.579c-17.357-7.388-28.871-16.668-28.871-36.258c0-18.044 13.748-31.792 35.229-31.792c15.294 0 26.292 5.328 34.196 19.247l-18.731 12.029c-4.125-7.389-8.591-10.31-15.465-10.31c-7.046 0-11.514 4.468-11.514 10.31c0 7.217 4.468 10.139 14.778 14.608l6.014 2.577c20.449 8.765 31.963 17.699 31.963 37.804c0 21.654-17.012 33.51-39.867 33.51c-22.339 0-36.774-10.654-43.819-24.574"/></g></svg></button></li>
                </ul>
            </div>

            <br>

            <div id="infoPara" style="text-align: center;">
                <p>The specific version of pseudocode that this interpreter supports is the
                    CIE 0478 version, which you can find the documentation for <a target="_blank" href="https://www.cambridgeinternational.org/Images/697167-2026-2028-syllabus.pdf">here</a>.
                    <br>
                    <br>
                    Note: There may be features supported in this interpreter which are not explicitly mentioned in the guide. <a href='/about#uniqueFeatures'>Learn more</a>.


                </p>
            </div>

        </div>

        <div class="ad-wrapper">
            <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-9837178944354824"
            data-ad-slot="4592956241"
            data-ad-format="auto"
            data-full-width-responsive="true">
            </ins>
            <script>
                if(window.matchMedia("(min-width: 1400px)").matches){
                    (adsbygoogle = window.adsbygoogle || []).push({});
                }

            </script>
        </div>


    </editor-main>



    <dialog class="modal" id="input-modal">
        <div id="modal-title">Enter here</div>
        <br>
        <input type="text" required id="input-box">
        <br>
        <br>
        <div class="modal-buttons">
            <input type="button" value="Cancel" id="input-cancel">
            <input type="button" value="Enter" id="input-enter">
           
        </div>
    </dialog>

    <div id="settings-wrapper">
        <dialog class="modal" id="settings-modal">

            <div class="modal-header" id="settings-header">
                <div class="modal-title"><h3 id="stng-mdl-ttl">Settings</h3></div>
                <button id="close-settings" class="close-btn"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 1212 1312" preserveAspectRatio="xMidYMid meet"><path fill="currentColor" d="M1202 1066q0 40-28 68l-136 136q-28 28-68 28t-68-28L608 976l-294 294q-28 28-68 28t-68-28L42 1134q-28-28-28-68t28-68l294-294L42 410q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294l294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68L880 704l294 294q28 28 28 68z"/></svg></button>
            </div>

            <br>
           
            <ul id="settings-container">

                

                <li>

                    <div class="container-any">
                        Line numbers

                        <input id="Ln-toggle" class="switch" type="checkbox">

                    </div>

                </li>

                <li>

                    <div class="container-any">
                        Line Wrapping

                        <input id="Lw-toggle" class="switch" type="checkbox">

                    </div>

                </li>

                <li>

                    <div class="container-any">
                        Auto-complete

                        <input id="Ac-toggle" class="switch" type="checkbox">

                    </div>

                </li>

                <li>

                    <div class="container-any">
                        Auto-ligate

                        <input id="Lg-toggle" class="switch" type="checkbox">
                        <button title="Automatically replace '&lt;--' with '←', '>=' with '≥' etc..." class="information-btn"
                            
                            onclick="alert(`Automatically replace '&lt;--' with '←', '>=' with '≥' etc...`)"

                            >i</button>
                    </div>

                </li>

                <li>

                    <div class="container-any">

                        Download program files directly from console
                        <input id="dpf-toggle" class="switch" type="checkbox">
                        
                    </div>

                </li>

                <li>

                    <div class="container-any">

                        Support Non-syllabus Features
                        <input id="Af-toggle" class="switch" type="checkbox">
                        
                    </div>

                </li>

                <li>
                    <div class="container-any">

                        Code Minimap
                        <input id="Mmp-toggle" class="switch" type="checkbox">
                        
                    </div>
                    
                </li>

                <li>

                    <div class="container-any">

                        Ignore file 'READ/WRITE' modes
                        <input id="Flmd-toggle" class="switch" type="checkbox">
                        
                    </div>

                </li>

                <li id="settings-footer-cont">
                    
                    <div class="dropdown" id="request-dropdown">
                        <div class="container-any" id="output-mode-container">
                            Output Mode 
                            <select class="dropdown-content" id="repl-nodes">
                                <option value="program" class="repl-node" id="repl-evaluate">Evaluate</option>
                                <option value="tokens" class="repl-node" id="repl-tokenise">Tokenise</option>
                                <option value="ast" class="repl-node" id="repl-ast">AST</option>
                                <option value="python" class="repl-node" id="repl-python">Python</a>
                            </select>

                        </div>

                        
                    </div>

                    

                    <div id="settings-footer">
                        <button title="Appearance" class="settings-footer-btn" id="apr-tgl"><svg width="24px" height="24px" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><g id="Layer_2" data-name="Layer 2"><g id="invisible_box" data-name="invisible box"><rect width="48" height="48" fill="none"/></g><g id="icons_Q2" data-name="icons Q2"><path fill="currentColor" d="M26.6,6H27c8.1,0,15,5.5,15,12S40.4,29,28,29c-3.8,0-5.8,2.2-6.4,4.3a5.5,5.5,0,0,0,2.3,6.1c1,.6,1,1.3.9,1.7a1.2,1.2,0,0,1-1.3.9C11.4,42,6,33,6,24S15.2,6,26.5,6h.1m-.1-4C13,2,2,11.8,2,24s8,22,21.5,22C29,46,31,39,26,36c-.9-.6-1-3,2-3,9,0,18-3,18-15C46,9,37,2,27,2Z"/><path fill="currentColor" d="M21,10a3,3,0,1,0,3,3,2.9,2.9,0,0,0-3-3Z"/><path fill="currentColor" d="M14,15a3,3,0,1,0,3,3,2.9,2.9,0,0,0-3-3Z"/><path fill="currentColor" d="M29,9a3,3,0,1,0,3,3,2.9,2.9,0,0,0-3-3Z"/><path fill="currentColor" d="M36,14a3,3,0,1,0,3,3,2.9,2.9,0,0,0-3-3Z"/></g></g></svg></button>
                        <button title="Reset all settings" class="settings-footer-btn" id="reset-settings"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M13.75 14.25h2.5q.325 0 .538.213T17 15t-.213.538t-.537.212h-2.5q-.325 0-.537-.213T13 15t.213-.537t.537-.213m.75 6v-.5h-.75q-.325 0-.537-.213T13 19t.213-.537t.537-.213h.75v-.5q0-.325.213-.537T15.25 17t.538.213t.212.537v2.5q0 .325-.213.538T15.25 21t-.537-.213t-.213-.537m3.25-2h2.5q.325 0 .538.213T21 19t-.213.538t-.537.212h-2.5q-.325 0-.537-.213T17 19t.213-.537t.537-.213m.25-2v-2.5q0-.325.213-.537T18.75 13t.538.213t.212.537v.5h.75q.325 0 .538.213T21 15t-.213.538t-.537.212h-.75v.5q0 .325-.213.538T18.75 17t-.537-.213T18 16.25M12 5Q9.075 5 7.038 7.038T5 12q0 1.8.813 3.3T8 17.75V16q0-.425.288-.712T9 15t.713.288T10 16v4q0 .425-.288.713T9 21H5q-.425 0-.712-.288T4 20t.288-.712T5 19h1.35Q4.8 17.75 3.9 15.938T3 12q0-1.875.713-3.512t1.924-2.85t2.85-1.925T12 3q1.625 0 3.475.95t4.875 4.675q.275.325.088.713t-.638.587q-.4.175-.8.013t-.525-.563q-.5-1.7-2.287-3.037T12 5"/></svg></button>
                    </div>
                </li>


            </ul>

            <ul id="appearance-settings">              
                <li>

                    <div class="color-picker">

                        <div class="caption">Keywords</div>
                        <input type="color" class="syntax-highlight-color" id="keyword-highlight">
                        <button title="Reset to VS default" id="keyword-col-reset" class="color-picker-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 344 392"><path fill="currentColor" d="M299 235q0 14-3 28L112 79q14-19 28.5-37.5T163 14l8-10q5 6 13.5 16.5t30.5 40t39 56.5t31 60.5t14 57.5zm-19 66l58 59l-27 27l-56-56q-36 32-84 32q-53 0-90.5-37.5T43 235q0-35 28-88L0 76l27-28l154 155z"/></svg></button>
                    </div>

                </li>

                <li>

                    <div class="color-picker">

                        <div class="caption">Control</div>
                        <input type="color" class="syntax-highlight-color" id="other-highlight">
                        <button title="Reset to VS default" id="other-col-reset" class="color-picker-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 344 392"><path fill="currentColor" d="M299 235q0 14-3 28L112 79q14-19 28.5-37.5T163 14l8-10q5 6 13.5 16.5t30.5 40t39 56.5t31 60.5t14 57.5zm-19 66l58 59l-27 27l-56-56q-36 32-84 32q-53 0-90.5-37.5T43 235q0-35 28-88L0 76l27-28l154 155z"/></svg></button>
                    </div>

                </li>

                <li>

                    <div class="color-picker">

                        <div class="caption">Data Types</div>
                        <input type="color" class="syntax-highlight-color" id="dt-highlight">
                        <button title="Reset to VS default" id="dt-col-reset" class="color-picker-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 344 392"><path fill="currentColor" d="M299 235q0 14-3 28L112 79q14-19 28.5-37.5T163 14l8-10q5 6 13.5 16.5t30.5 40t39 56.5t31 60.5t14 57.5zm-19 66l58 59l-27 27l-56-56q-36 32-84 32q-53 0-90.5-37.5T43 235q0-35 28-88L0 76l27-28l154 155z"/></svg></button>
                    </div>

                </li>

                <li>

                    <div class="color-picker">

                        <div class="caption">Variables</div>
                        <input type="color" class="syntax-highlight-color" id="ident-highlight">
                        <button title="Reset to VS default" id="ident-col-reset" class="color-picker-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 344 392"><path fill="currentColor" d="M299 235q0 14-3 28L112 79q14-19 28.5-37.5T163 14l8-10q5 6 13.5 16.5t30.5 40t39 56.5t31 60.5t14 57.5zm-19 66l58 59l-27 27l-56-56q-36 32-84 32q-53 0-90.5-37.5T43 235q0-35 28-88L0 76l27-28l154 155z"/></svg></button>
                    </div>

                </li>

                <li>

                    <div class="color-picker">

                        <div class="caption">Constants</div>
                        <input type="color" class="syntax-highlight-color" id="const-highlight">
                        <button title="Reset to VS default" id="const-col-reset" class="color-picker-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 344 392"><path fill="currentColor" d="M299 235q0 14-3 28L112 79q14-19 28.5-37.5T163 14l8-10q5 6 13.5 16.5t30.5 40t39 56.5t31 60.5t14 57.5zm-19 66l58 59l-27 27l-56-56q-36 32-84 32q-53 0-90.5-37.5T43 235q0-35 28-88L0 76l27-28l154 155z"/></svg></button>
                    </div>

                </li>

                <li>

                    <div class="color-picker">

                        <div class="caption">Functions</div>
                        <input type="color" class="syntax-highlight-color" id="fn-highlight">
                        <button title="Reset to VS default" id="fn-col-reset" class="color-picker-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 344 392"><path fill="currentColor" d="M299 235q0 14-3 28L112 79q14-19 28.5-37.5T163 14l8-10q5 6 13.5 16.5t30.5 40t39 56.5t31 60.5t14 57.5zm-19 66l58 59l-27 27l-56-56q-36 32-84 32q-53 0-90.5-37.5T43 235q0-35 28-88L0 76l27-28l154 155z"/></svg></button>
                    </div>

                </li>

                <li>

                    <div class="color-picker">

                        <div class="caption">Strings</div>
                        <input type="color" class="syntax-highlight-color" id="string-highlight">
                        <button title="Reset to VS default" id="string-col-reset" class="color-picker-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 344 392"><path fill="currentColor" d="M299 235q0 14-3 28L112 79q14-19 28.5-37.5T163 14l8-10q5 6 13.5 16.5t30.5 40t39 56.5t31 60.5t14 57.5zm-19 66l58 59l-27 27l-56-56q-36 32-84 32q-53 0-90.5-37.5T43 235q0-35 28-88L0 76l27-28l154 155z"/></svg></button>
                    </div>

                </li>

                <li>

                    <div class="color-picker">

                        <div class="caption">Chars</div>
                        <input type="color" class="syntax-highlight-color" id="char-highlight">
                        <button title="Reset to VS default" id="char-col-reset" class="color-picker-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 344 392"><path fill="currentColor" d="M299 235q0 14-3 28L112 79q14-19 28.5-37.5T163 14l8-10q5 6 13.5 16.5t30.5 40t39 56.5t31 60.5t14 57.5zm-19 66l58 59l-27 27l-56-56q-36 32-84 32q-53 0-90.5-37.5T43 235q0-35 28-88L0 76l27-28l154 155z"/></svg></button>
                    </div>

                </li>

                <li>

                    <div class="color-picker">

                        <div class="caption">Booleans</div>
                        <input type="color" class="syntax-highlight-color" id="bool-highlight">
                        <button title="Reset to VS default" id="bool-col-reset" class="color-picker-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 344 392"><path fill="currentColor" d="M299 235q0 14-3 28L112 79q14-19 28.5-37.5T163 14l8-10q5 6 13.5 16.5t30.5 40t39 56.5t31 60.5t14 57.5zm-19 66l58 59l-27 27l-56-56q-36 32-84 32q-53 0-90.5-37.5T43 235q0-35 28-88L0 76l27-28l154 155z"/></svg></button>
                    </div>

                </li>

                <li>

                    <div class="color-picker">

                        <div class="caption">Operators</div>
                        <input type="color" class="syntax-highlight-color" id="op-highlight">
                        <button title="Reset to VS default" id="op-col-reset" class="color-picker-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 344 392"><path fill="currentColor" d="M299 235q0 14-3 28L112 79q14-19 28.5-37.5T163 14l8-10q5 6 13.5 16.5t30.5 40t39 56.5t31 60.5t14 57.5zm-19 66l58 59l-27 27l-56-56q-36 32-84 32q-53 0-90.5-37.5T43 235q0-35 28-88L0 76l27-28l154 155z"/></svg></button>
                    </div>

                </li>

                <li>

                    <div class="color-picker">

                        <div class="caption">Numbers</div>
                        <input type="color" class="syntax-highlight-color" id="num-highlight">
                        <button title="Reset to VS default" id="num-col-reset" class="color-picker-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 344 392"><path fill="currentColor" d="M299 235q0 14-3 28L112 79q14-19 28.5-37.5T163 14l8-10q5 6 13.5 16.5t30.5 40t39 56.5t31 60.5t14 57.5zm-19 66l58 59l-27 27l-56-56q-36 32-84 32q-53 0-90.5-37.5T43 235q0-35 28-88L0 76l27-28l154 155z"/></svg></button>
                    </div>

                </li>

                <li>

                    <div class="color-picker">

                        <div class="caption">Comments</div>
                        <input type="color" class="syntax-highlight-color" id="cmnt-highlight">
                        <button title="Reset to VS default" id="cmnt-col-reset" class="color-picker-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 344 392"><path fill="currentColor" d="M299 235q0 14-3 28L112 79q14-19 28.5-37.5T163 14l8-10q5 6 13.5 16.5t30.5 40t39 56.5t31 60.5t14 57.5zm-19 66l58 59l-27 27l-56-56q-36 32-84 32q-53 0-90.5-37.5T43 235q0-35 28-88L0 76l27-28l154 155z"/></svg></button>
                    </div>

                </li>

                <li>

                    <div class="color-picker">

                        <div class="caption">Symbols</div>
                        <input type="color" class="syntax-highlight-color" id="sym-highlight">
                        <button title="Reset to VS default" id="sym-col-reset" class="color-picker-btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 344 392"><path fill="currentColor" d="M299 235q0 14-3 28L112 79q14-19 28.5-37.5T163 14l8-10q5 6 13.5 16.5t30.5 40t39 56.5t31 60.5t14 57.5zm-19 66l58 59l-27 27l-56-56q-36 32-84 32q-53 0-90.5-37.5T43 235q0-35 28-88L0 76l27-28l154 155z"/></svg></button>
                    </div>

                </li>



                <li>

                    <div id="font-menu" class="container-any">
                        <div id="font-size-cont">
                            Font Size
                            <input type="number" id="font-size" name="quantity" min="5" max="1000" value="13">
                            px
                        </div>
                        
                        <div class="dropdown">
                            <div class="container-any" id="font-fam-container">
                                Font Family
                                <select class="dropdown-content" id="fonts">
                                    <option class="font-optn" value="brass-mono-optn">Brass Mono</option>
                                    <option class="font-optn" value="cascadia-optn" >Cascadia Code</option>
                                    <option class="font-optn" value="consolas-optn">Consolas</option>
                                    <option class="font-optn" title="(font specified in guide)" value="courier-optn">Courier New</option>
                                    <option class="font-optn" value="jetbrains-mono-optn">Jetbrains Mono</option>
                                    <option class="font-optn" value="kode-mono-optn">Kode Mono</option>
                                    <option class="font-optn" value="monospace-optn">Monospace</option>
                                    <option class="font-optn" value="sans-serif-optn">Sans Serif</option>
                                    
                                </select>

                            </div>

                            
                        </div>
                            
                    </div>

                </li>

                <li id="appearance-settings-footer">
                    <div id="settings-footer">
                        <button title="Save preset" class="settings-footer-btn" id="save-preset"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 23 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7.558 3.75H7.25a3.5 3.5 0 0 0-3.5 3.5v9.827a3.173 3.173 0 0 0 3.173 3.173v0m.635-16.5v2.442a2 2 0 0 0 2 2h2.346a2 2 0 0 0 2-2V3.75m-6.346 0h6.346m0 0h.026a3 3 0 0 1 2.122.879l3.173 3.173a3.5 3.5 0 0 1 1.025 2.475v6.8a3.173 3.173 0 0 1-3.173 3.173v0m-10.154 0V15a3 3 0 0 1 3-3h4.154a3 3 0 0 1 3 3v5.25m-10.154 0h10.154"/></svg></button>
                        <button title="Upload preset" class="settings-footer-btn" id="upload-preset"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 16.5 18"><path fill="currentColor" fill-rule="evenodd" d="M11.78 5.841a.75.75 0 0 1-1.06 0l-1.97-1.97v7.379a.75.75 0 0 1-1.5 0V3.871l-1.97 1.97a.75.75 0 0 1-1.06-1.06l3.25-3.25L8 1l.53.53l3.25 3.25a.75.75 0 0 1 0 1.061ZM2.5 9.75a.75.75 0 0 0-1.5 0V13a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V9.75a.75.75 0 0 0-1.5 0V13a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V9.75Z" clip-rule="evenodd"/></svg></button>
                        <button title="System" class="settings-footer-btn" id="exit-apr-panel"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="25" viewBox="0,0,800,800"><g fill="currentColor" transform="translate(-228,-168)"><g data-paper-data="{&quot;isPaintingLayer&quot;:true}" fill-rule="nonzero" stroke="none" fill="currentColor" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" style="mix-blend-mode: normal"><path d="M1028,168v800h-800v-800zM608.217,943.26137c-0.2507,0.04861 -0.46941,0.26201 -0.5357,0.59967l-0.56972,14.24262l0.11196,0.55212v0l0.42012,0.53469l3.4525,2.46597l0.3922,0.13068v0l0.49571,-0.13068l3.45243,-2.46597l0.367,-0.40715l0.16512,-0.67966l-0.56971,-14.24262l-0.13699,-0.36412c-0.16357,-0.19613 -0.45603,-0.28471 -0.78376,-0.17981l-2.36868,1.18436l-0.50546,0.12343v0l-0.63329,-0.12343l-2.36875,-1.18436l-0.385,-0.05574zM599.38698,939.50954c-0.30065,0.05718 -0.56325,0.31012 -0.6429,0.70823l-1.13819,20.48769l0.13316,0.46875c0.18651,0.2587 0.54667,0.38912 0.94961,0.26708l6.69847,-3.09153l0.2817,-0.23584v0l0.16135,-0.42596l0.59667,-14.31758l-0.0896,-0.37354v0l-0.33207,-0.34152l-6.15681,-3.07842l-0.4614,-0.06737zM617.0749,942.65532l-0.3164,0.29526v0l-0.1052,0.41979l0.59656,14.31758l0.12849,0.39319v0l0.31464,0.26861l6.69849,3.09153l0.52026,0.04429c0.32794,-0.09025 0.58386,-0.39679 0.56256,-0.78012l-1.1382,-20.48769l-0.19064,-0.46459c-0.21799,-0.24449 -0.58604,-0.3401 -0.91369,-0.17627z" data-paper-data="{&quot;index&quot;:null}" fill="none"/><path d="M794.66667,268l5.87575,0.16976c52.49346,3.04156 94.12425,46.57435 94.12425,99.83024v400l-0.16976,5.87591c-3.04156,52.49484 -46.57435,94.12409 -99.83024,94.12409h-150l-3.88746,-0.22425c-16.5783,-1.92544 -29.44587,-16.01408 -29.44587,-33.10908c0,-18.41 14.92333,-33.33333 33.33333,-33.33333h150l3.88734,-0.22425c16.57785,-1.92544 29.44599,-16.01408 29.44599,-33.10908v-400l-0.22426,-3.88734c-1.92552,-16.57785 -16.01469,-29.44599 -33.10907,-29.44599h-166.66667l-3.88746,-0.22426c-16.5783,-1.92552 -29.44587,-16.01469 -29.44587,-33.10907c0,-18.40933 14.92333,-33.33333 33.33333,-33.33333zM484.90667,450.149c13.01667,13.01733 13.01667,34.123 0,47.14033l-37.38,37.37733h180.47333c18.41,0 33.33333,14.92333 33.33333,33.33333c0,18.41 -14.92333,33.33333 -33.33333,33.33333h-180.47333l37.38,37.37667c13.01667,13.01667 13.01667,34.12333 0,47.14c-13.02,13.02 -34.12333,13.02 -47.14,0l-94.28333,-94.28c-13.01667,-13.01667 -13.01667,-34.12333 0,-47.14l94.28333,-94.281c13.01667,-13.01767 34.12,-13.01767 47.14,0z" data-paper-data="{&quot;index&quot;:null}" fill="currentColor"/></g></g></svg></button>
                    </div>
                </li>

            </ul>
            
            </div>
        </dialog>
    </div>

    

    <dialog class="modal" id="share-modal">

        <div class="modal-header" id="share-header">
            <div class="modal-title" id="share-title"><h3>Share</h3></div>
            <button id="close-share" class="close-btn" onclick="document.getElementById('share-modal').close()"><svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" width="15" height="10" viewBox="0 0 1205 1210" preserveAspectRatio="xMidYMid meet"><path fill="currentColor" d="M1202 1066q0 40-28 68l-136 136q-28 28-68 28t-68-28L608 976l-294 294q-28 28-68 28t-68-28L42 1134q-28-28-28-68t28-68l294-294L42 410q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294l294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68L880 704l294 294q28 28 28 68z"/></svg></button>
        </div>

        <br>

        <div id="pre-gen">

            <div id="project-name-inpt">
                <label for="project-name">Project Name</label>
                <input spellcheck="false" name="project" placeholder="Project Name" required type="text" id="project-name"> 

                <br>

                <div id="pre-gen-footer">
                    <input  id="gen-btn" type="submit" value="Generate Link">
                </div>
                 
            </div>
             


        </div>

        <div id="gen">
            <div id="gen-header">
                Share <span id="share-msg">your code</span> using this link:
            </div>
            
            <br>
            <br>
            <div class="url">
            
                
                <textarea id="share-link">https://pseudowhizz.org/</textarea>

                <div id="copy-link-container">
                    <svg id="copy-link" xmlns="http://www.w3.org/2000/svg" width="23" height="23" viewBox="0 0 24 20"><path fill="currentColor" d="M19.53 8L14 2.47a.75.75 0 0 0-.53-.22H11A2.75 2.75 0 0 0 8.25 5v1.25H7A2.75 2.75 0 0 0 4.25 9v10A2.75 2.75 0 0 0 7 21.75h7A2.75 2.75 0 0 0 16.75 19v-1.25H17A2.75 2.75 0 0 0 19.75 15V8.5a.75.75 0 0 0-.22-.5Zm-5.28-3.19l2.94 2.94h-2.94Zm1 14.19A1.25 1.25 0 0 1 14 20.25H7A1.25 1.25 0 0 1 5.75 19V9A1.25 1.25 0 0 1 7 7.75h1.25V15A2.75 2.75 0 0 0 11 17.75h4.25ZM17 16.25h-6A1.25 1.25 0 0 1 9.75 15V5A1.25 1.25 0 0 1 11 3.75h1.75V8.5a.76.76 0 0 0 .75.75h4.75V15A1.25 1.25 0 0 1 17 16.25Z"></path></svg>

                </div>


                
                
            </div>

            <br>

            <div class="btn-any" title="Share" id="share-more"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 25"><path fill="currentColor" d="m21.707 11.293l-8-8A1 1 0 0 0 12 4v3.545A11.015 11.015 0 0 0 2 18.5V20a1 1 0 0 0 1.784.62a11.456 11.456 0 0 1 7.887-4.049c.05-.006.175-.016.329-.026V20a1 1 0 0 0 1.707.707l8-8a1 1 0 0 0 0-1.414ZM14 17.586V15.5a1 1 0 0 0-1-1c-.255 0-1.296.05-1.562.085a14.005 14.005 0 0 0-7.386 2.948A9.013 9.013 0 0 1 13 9.5a1 1 0 0 0 1-1V6.414L19.586 12Z"/></svg></div>
        </div>

        

        <br>
        
        
           
        </div>
    </dialog>
    

    <br>

    <br>


    <div id="footer">
        <div id="copy-right">
            © 2026 Pseudowhizz. All rights reserved.
        </div>

        <div id="Socials">

            <ul>
                <li class="social" id="youtube" title="youtube"><svg  width="50px" height="50px" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><defs><style>.cls-1{ stroke-width: 2; fill:"currentColor";stroke:"currentColor";stroke-linecap:round;stroke-linejoin:round;}</style></defs><path class="a" d="M43.1124,14.394a5.0056,5.0056,0,0,0-3.5332-3.5332c-2.3145-.8936-24.7326-1.3314-31.2358.0256A5.0059,5.0059,0,0,0,4.81,14.42c-1.0446,4.583-1.1239,14.4914.0256,19.1767A5.006,5.006,0,0,0,8.369,37.13c4.5829,1.0548,26.3712,1.2033,31.2358,0a5.0057,5.0057,0,0,0,3.5332-3.5333C44.2518,28.6037,44.3311,19.31,43.1124,14.394Z"/><path class="a" d="M30.5669,23.9952,20.1208,18.004V29.9863Z"/></svg></li>
                
                
                <li class="social" id="mailIcon" title="pseudowhizz@gmail.com">

                    <svg  version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
                        viewBox="0 0 512 512"  xml:space="preserve">
                    <style type="text/css">
                        .cls-1{fill:"currentColor"; stroke:"currentColor";}
                    </style>
                    <g>
                        <path  class="st0" d="M510.746,110.361c-2.128-10.754-6.926-20.918-13.926-29.463c-1.422-1.794-2.909-3.39-4.535-5.009
                            c-12.454-12.52-29.778-19.701-47.531-19.701H67.244c-17.951,0-34.834,7-47.539,19.708c-1.608,1.604-3.099,3.216-4.575,5.067
                            c-6.97,8.509-11.747,18.659-13.824,29.428C0.438,114.62,0,119.002,0,123.435v265.137c0,9.224,1.874,18.206,5.589,26.745
                            c3.215,7.583,8.093,14.772,14.112,20.788c1.516,1.509,3.022,2.901,4.63,4.258c12.034,9.966,27.272,15.45,42.913,15.45h377.51
                            c15.742,0,30.965-5.505,42.967-15.56c1.604-1.298,3.091-2.661,4.578-4.148c5.818-5.812,10.442-12.49,13.766-19.854l0.438-1.05
                            c3.646-8.377,5.497-17.33,5.497-26.628V123.435C512,119.06,511.578,114.649,510.746,110.361z M34.823,99.104
                            c0.951-1.392,2.165-2.821,3.714-4.382c7.689-7.685,17.886-11.914,28.706-11.914h377.51c10.915,0,21.115,4.236,28.719,11.929
                            c1.313,1.327,2.567,2.8,3.661,4.272l2.887,3.88l-201.5,175.616c-6.212,5.446-14.21,8.443-22.523,8.443
                            c-8.231,0-16.222-2.99-22.508-8.436L32.19,102.939L34.823,99.104z M26.755,390.913c-0.109-0.722-0.134-1.524-0.134-2.341V128.925
                            l156.37,136.411L28.199,400.297L26.755,390.913z M464.899,423.84c-6.052,3.492-13.022,5.344-20.145,5.344H67.244
                            c-7.127,0-14.094-1.852-20.142-5.344l-6.328-3.668l159.936-139.379l17.528,15.246c10.514,9.128,23.922,14.16,37.761,14.16
                            c13.89,0,27.32-5.032,37.827-14.16l17.521-15.253L471.228,420.18L464.899,423.84z M485.372,388.572
                            c0,0.803-0.015,1.597-0.116,2.304l-1.386,9.472L329.012,265.409l156.36-136.418V388.572z"/>
                    </g>
                    </svg>
                </li>


                <!--<li class="social" title="discord" id="discord"><svg stroke-width: 2 fill="currentColor" width="50px" height="50px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M20.992 20.163c-1.511-0.099-2.699-1.349-2.699-2.877 0-0.051 0.001-0.102 0.004-0.153l-0 0.007c-0.003-0.048-0.005-0.104-0.005-0.161 0-1.525 1.19-2.771 2.692-2.862l0.008-0c1.509 0.082 2.701 1.325 2.701 2.847 0 0.062-0.002 0.123-0.006 0.184l0-0.008c0.003 0.050 0.005 0.109 0.005 0.168 0 1.523-1.191 2.768-2.693 2.854l-0.008 0zM11.026 20.163c-1.511-0.099-2.699-1.349-2.699-2.877 0-0.051 0.001-0.102 0.004-0.153l-0 0.007c-0.003-0.048-0.005-0.104-0.005-0.161 0-1.525 1.19-2.771 2.692-2.862l0.008-0c1.509 0.082 2.701 1.325 2.701 2.847 0 0.062-0.002 0.123-0.006 0.184l0-0.008c0.003 0.048 0.005 0.104 0.005 0.161 0 1.525-1.19 2.771-2.692 2.862l-0.008 0zM26.393 6.465c-1.763-0.832-3.811-1.49-5.955-1.871l-0.149-0.022c-0.005-0.001-0.011-0.002-0.017-0.002-0.035 0-0.065 0.019-0.081 0.047l-0 0c-0.234 0.411-0.488 0.924-0.717 1.45l-0.043 0.111c-1.030-0.165-2.218-0.259-3.428-0.259s-2.398 0.094-3.557 0.275l0.129-0.017c-0.27-0.63-0.528-1.142-0.813-1.638l0.041 0.077c-0.017-0.029-0.048-0.047-0.083-0.047-0.005 0-0.011 0-0.016 0.001l0.001-0c-2.293 0.403-4.342 1.060-6.256 1.957l0.151-0.064c-0.017 0.007-0.031 0.019-0.040 0.034l-0 0c-2.854 4.041-4.562 9.069-4.562 14.496 0 0.907 0.048 1.802 0.141 2.684l-0.009-0.11c0.003 0.029 0.018 0.053 0.039 0.070l0 0c2.14 1.601 4.628 2.891 7.313 3.738l0.176 0.048c0.008 0.003 0.018 0.004 0.028 0.004 0.032 0 0.060-0.015 0.077-0.038l0-0c0.535-0.72 1.044-1.536 1.485-2.392l0.047-0.1c0.006-0.012 0.010-0.027 0.010-0.043 0-0.041-0.026-0.075-0.062-0.089l-0.001-0c-0.912-0.352-1.683-0.727-2.417-1.157l0.077 0.042c-0.029-0.017-0.048-0.048-0.048-0.083 0-0.031 0.015-0.059 0.038-0.076l0-0c0.157-0.118 0.315-0.24 0.465-0.364 0.016-0.013 0.037-0.021 0.059-0.021 0.014 0 0.027 0.003 0.038 0.008l-0.001-0c2.208 1.061 4.8 1.681 7.536 1.681s5.329-0.62 7.643-1.727l-0.107 0.046c0.012-0.006 0.025-0.009 0.040-0.009 0.022 0 0.043 0.008 0.059 0.021l-0-0c0.15 0.124 0.307 0.248 0.466 0.365 0.023 0.018 0.038 0.046 0.038 0.077 0 0.035-0.019 0.065-0.046 0.082l-0 0c-0.661 0.395-1.432 0.769-2.235 1.078l-0.105 0.036c-0.036 0.014-0.062 0.049-0.062 0.089 0 0.016 0.004 0.031 0.011 0.044l-0-0.001c0.501 0.96 1.009 1.775 1.571 2.548l-0.040-0.057c0.017 0.024 0.046 0.040 0.077 0.040 0.010 0 0.020-0.002 0.029-0.004l-0.001 0c2.865-0.892 5.358-2.182 7.566-3.832l-0.065 0.047c0.022-0.016 0.036-0.041 0.039-0.069l0-0c0.087-0.784 0.136-1.694 0.136-2.615 0-5.415-1.712-10.43-4.623-14.534l0.052 0.078c-0.008-0.016-0.022-0.029-0.038-0.036l-0-0z"></path></svg></li>-->
            
                <li class="social" title="github" id="github"><svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" viewBox="0 0 432 416"><path fill="currentColor" d="M213.5 0q88.5 0 151 62.5T427 213q0 70-41 125.5T281 416q-14 2-14-11v-58q0-27-15-40q44-5 70.5-27t26.5-77q0-34-22-58q11-26-2-57q-18-5-58 22q-26-7-54-7t-53 7q-18-12-32.5-17.5T107 88h-6q-12 31-2 57q-22 24-22 58q0 55 27 77t70 27q-11 10-13 29q-42 18-62-18q-12-20-33-22q-2 0-4.5.5t-5 3.5t8.5 9q14 7 23 31q1 2 2 4.5t6.5 9.5t13 10.5T130 371t30-2v36q0 13-14 11q-64-22-105-77.5T0 213q0-88 62.5-150.5T213.5 0z"/></svg></li>
            </ul>
        </div>
    </div>

 
    
    <script type="module" >

        import { default_code } from './Prewritten/Default.js';
        import {DescBox, select_all, highlight_all_tokens} from './EditorUtils/Utils.js';
        let selectedTab = "none";
        


        let repl_request = "program";

        let last_scroll_height = 0;

        let ol_files = ["Main.pseudo", "Sample.txt"];

        let savedEl = null; 

      
        function manageNavBar() {
            const nav = document.getElementById('navBar');

            if (window.innerWidth >= 1400) {
                // remove only if present
                const el = document.getElementById('navextras');
                if (el) {
                savedEl = el;  // keep the element in memory
                el.remove();
                }
            } else {
                // add back if missing
                if (!document.getElementById('navextras') && savedEl) {
                nav.appendChild(savedEl); // restore to <ul>
                }
            }

            
        }

        window.addEventListener("resize", manageNavBar);
        window.addEventListener("load", manageNavBar);




        function open_file(filepath) {
            fetch(filepath)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok: ' + response.statusText);
                    }
                    return response.text(); // Read as plain text
                })
                .then(text => {
                    localStorage.setItem('Saved', text); // Store the solution in localStorage
                    window.location.href = './index.html'; // Redirect to the editor page
                })
                .catch(error => {
                    console.error('Error fetching file:', error);
                });
        }

        const maxFiles = Infinity;
        

        let adapted = "";
        let nameSpace = new Set();
        let hasSaved = false;


        window.nameSpace = nameSpace;


        let progam_status = false;

        function isAlpha(str) {


            for(const letter of str){
                if(/^[A-Za-z]+$/.test(str[0]) && /^[A-Za-z]+$/.test(letter)){
                    return true;
                }
            }

            return false;
        }


        var themeToggle = document.getElementById('theme-toggle');





        themeToggle.style.transition = "none";
        themeToggle.checked = (localStorage.getItem('lightMode') == "active") ? false : true;

        themeToggle.addEventListener("click", () => {

            setTimeout(() => {


                toggle_sym_col();

            }, 1);


        })
        
        let prev_token = null;
        let vars = [];
        let varTypeMap = new Map();
        let constTypeMap = new Map();
        let native_keywords = ["NUM_TO_STR","STR_TO_NUM" ,"ARRAY","DECLARE","CONSTANT","OUTPUT","IF", "ELSEIF","ENDWHILE","THEN","ENDIF","ELSE", "INPUT", "FUNCTION","ENDFUNCTION","PROCEDURE","ENDPROCEDURE","CALL","CASE","OF","OTHERWISE","ENDCASE","RETURNS","RETURN","OPENFILE","CLOSEFILE","READFILE","WRITEFILE","READ","WRITE","FOR","NEXT","WHILE","DO","REPEAT","UNTIL","AND","OR","NOT","LCASE","UCASE","ROUND","RANDOM","SUBSTRING","EOF","STRING","BOOLEAN","CHAR","INTEGER","REAL", "DIV", "MOD", "LENGTH", "STEP", "TO", "TRUE", "FALSE"];
        let filenames = [];
        let keywordList = [...native_keywords, ...vars, ...methods, ...constants, ...filenames, ...procedures];
        
        const ns = new namespace();

        function trimAll(str) {
            return str.replace(/\s+/g, "");
        }

        function getPreviousToken() {
            
            const cursor = editor.getCursor();

            const lineTokens = editor.getLineTokens(cursor.line); 
            if (!lineTokens || lineTokens.length === 0) return null;


            let currentIndex = lineTokens.findIndex(t => t.end >= cursor.ch);

            if (currentIndex === -1) {
                currentIndex = lineTokens.length;
            }


            if (currentIndex > 0) {
                return lineTokens[currentIndex - 1];
            }

            return null;
        }

        let show_fn_desc = false;

        CodeMirror.defineMode("CIEpseudocode", function () {

        
            

            const keywords = /^(READFILE|WRITEFILE|OPENFILE|CLOSEFILE|DECLARE|CONSTANT|OUTPUT|INPUT|FUNCTION|ENDFUNCTION|PROCEDURE|ENDPROCEDURE)$/i;
            const datatypes = /^(ARRAY|INTEGER|REAL|CHAR|STRING|BOOLEAN)$/i;
            const boolean = /^(TRUE|FALSE)$/i;
            const native = /^(LCASE|UCASE|NUM_TO_STR|STR_TO_NUM|SUBSTRING|EOF|ROUND|RANDOM|LENGTH)$/i;
            const other = /^(ELSEIF|IF|ELSE|ENDIF|THEN|CASE|OF|ENDCASE|OTHERWISE|RETURNS|RETURN|READ|WRITE|STEP|FOR|TO|CALL|NEXT|WHILE|REPEAT|ENDWHILE|DO|UNTIL)$/i;
            const logical = /^(MOD|DIV|NOT|AND|OR|)$/i;
            
            return {

                startState: function() {
                    return { prevToken: null };
                },

                token: function (stream, state) {

                    if (selectedTab.endsWith('.pseudo')) {
                        keywordList = [...native_keywords, ...vars, ...methods, ...constants, ...procedures, ...filenames];
                        
                        const codeVal = trimAll(editor.getValue());

                        for(const fn of methods){



                            if(!codeVal.includes(`FUNCTION${fn}(`)){

                                ns.refresh("methods", fn);
                                //methods = methods.filter(f => f != fn);

                            }

                        } 

                        for(const p of procedures){

                            if(!codeVal.includes(`PROCEDURE${p}(`)){

                                ns.refresh("procedures", p);
                                //procedures = procedures.filter(i => i != p);

                            }

                        }

                        for(const c of constants){

                            if(!codeVal.includes(`CONSTANT${c}<`) && !codeVal.includes(`CONSTANT${c}←`)){

                                constTypeMap.delete(c);
                                //constants = constants.filter(i => i != c);
                                ns.refresh("constants", c);
                            }

                        }
                        

                        for(const v of vars){

                            if(!codeVal.includes(`DECLARE${v}:`)){

                                vars = vars.filter(i => i != v);
                                varTypeMap.delete(v);

                            }
                            

                        }

                        for(const f of filenames){
        
                            if(!codeVal.includes(`OPENFILE${f}FORREAD`) && !codeVal.includes(`OPENFILE${f}FORWRITE`)){



                                filenames = filenames.filter(i => i != f);

                            }
                            

                        }

                        if (stream.eatSpace()) return null;

                        // helper functions for Unicode-aware identifiers
                        function readIdentifier(stream) {
                            let word = "";
                            let ch = stream.peek();

                            // If the first character exists, consume it
                            if (!ch) return null;

                            // Keep consuming characters until we hit whitespace, punctuation, or end of line
                            while (!stream.eol()) {
                                ch = stream.peek();
                                if (!ch || /\s/.test(ch) || /[\(\)\[\]\{\};,]/.test(ch)) break;
                                word += stream.next();
                            }

                            return word || null;
                        }

                        let word = "";



                        word = stream.match(/^[a-zA-Z_][a-zA-Z0-9_]*/);
                        const read = JSON.stringify(word).slice(2,-2);
                      
                        
                       
                        
                        if(JSON.stringify(word) == JSON.stringify(word).toUpperCase()){


                            if (word && keywords.test(word)){
                                prev_token = read; 
                                return "keyword";
                            }
                            else if(word && datatypes.test(word)){ 
                                prev_token = read; 
                                return "datatype";
                            }
                            else if (word && other.test(word)){ 
                                prev_token = read; 
                                return "other-token";
                            }
                            else if (word && native.test(word)){ 

                                show_fn_desc = true;
                                prev_token = read; 
                                return "native";
                            }
                            else if (word && boolean.test(word)){ 


                                prev_token = read; 
                                return "boolean";
                            }
                            else if(word && logical.test(word)){ 
                                prev_token = read; 
                                return "logical";
                            }
                        }


                        
                        

                        if (word) {
                            
                            const raw = JSON.stringify(word);


                            let type = "variable";

                            const is_fn = codeVal.includes(`FUNCTION${read}(`);

                            const is_prcdr = codeVal.includes(`PROCEDURE${read}(`);

                            

                            const is_const = codeVal.includes(`CONSTANT${read}<`) || codeVal.includes(`CONSTANT${read}←`);

                            const is_var = new RegExp(`DECLARE${String(read).replace(/[.*+?^${}()|[\]\\]/g, "\\$&")}:(REAL|INTEGER|BOOLEAN|STRING|CHAR|ARRAY\\[.*?\\]OF(REAL|INTEGER|BOOLEAN|STRING|CHAR))`).test(codeVal);

                            const is_file = codeVal.includes(`OPENFILE${read}.txtFORREAD`) || codeVal.includes(`OPENFILE${read}.txtFORWRITE`)

                            if(is_fn && !methods.includes(read)) methods.push(read);

                            else if(is_prcdr && !procedures.includes(read)) procedures.push(read);

                            else if(is_const && !constants.includes(read)) constants.push(read);
                            
                            else if(is_var && !vars.includes(read)){

        

                                vars.push(read);

                                if(codeVal.includes(`DECLARE${read}:INTEGER`)) varTypeMap.set(read, 'INTEGER');
                                else if(codeVal.includes(`DECLARE${read}:REAL`)) varTypeMap.set(read, 'REAL');
                                else if(codeVal.includes(`DECLARE${read}:BOOLEAN`)) varTypeMap.set(read, 'BOOLEAN');
                                else if(codeVal.includes(`DECLARE${read}:STRING`)) varTypeMap.set(read, 'STRING');
                                else if(codeVal.includes(`DECLARE${read}:CHAR`)) varTypeMap.set(read, 'CHAR');
                                else if(codeVal.includes(`DECLARE${read}:ARRAY`)){ 
                                    if(new RegExp(`DECLARE${String(read).replace(/[.*+?^${}()|[\]\\]/g, "\\$&")}:ARRAY\\[.*?\\]OFINTEGER`).test(codeVal))varTypeMap.set(read, 'ARRAY OF INTEGER');
                                    else if(new RegExp(`DECLARE${String(read).replace(/[.*+?^${}()|[\]\\]/g, "\\$&")}:ARRAY\\[.*?\\]OFREAL`).test(codeVal))varTypeMap.set(read, 'ARRAY OF REAL');
                                    else if(new RegExp(`DECLARE${String(read).replace(/[.*+?^${}()|[\]\\]/g, "\\$&")}:ARRAY\\[.*?\\]OFBOOLEAN`).test(codeVal))varTypeMap.set(read, 'ARRAY OF BOOLEAN');
                                    else if(new RegExp(`DECLARE${String(read).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}:ARRAY\\[.*?\\]OFSTRING`).test(codeVal))varTypeMap.set(read, 'ARRAY OF STRING');
                                    else if(new RegExp(`DECLARE${String(read).replace(/[.*+?^${}()|[\]\\]/g, "\\$&")}:ARRAY\\[.*?\\]OFCHAR`).test(codeVal))varTypeMap.set(read, 'ARRAY OF CHAR');
                                }; 

                            }
                            else if(is_file && !filenames.includes(`${read}.txt`)) filenames.push(`${read}.txt`);

                            if( methods.includes(read) || procedures.includes(read)) type = "userFn";

                            
                            else if(constants.includes(read))  type = "constant";
                            

                            prev_token = read;
                            
                            return type;

                            
                        }

  

                        if (stream.match(/^"[^"]*"/)){ 
                            prev_token = read; 
                            return "string"
                        };

                        // Short single-quote strings (<=3 chars)
                        const shortStringMatch = stream.match(/^'[^']*'/);
                        if (shortStringMatch) {
                            
                            const sliced = JSON.stringify(shortStringMatch).slice(2, -2);
                            

                            if (0 < sliced.length && sliced.length <= 3) return "char";

                            
                        }

                        // Numbers
                        if (stream.match(/^\d+/)){


                            prev_token = read; 
                            return "number";

                        } 

                        // Comments
                        if (stream.match(/^\/\/.*/)){ 
                            prev_token = read; 
                            return "comment";
                        }

                        prev_token = read; 


                        stream.next();


                        return "other";
                    }

                    stream.next();
                    return null;
                }
            

            }
        });

        function debounce(func, delay) {
            let timeout;
            return function (...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        }

        function getCurrentWord(cm) {
            const cursor = cm.getCursor();
            const token = cm.getTokenAt(cursor);

            // Only accept valid identifiers
            const word = token.string;
            const isIdentifier = isAlpha(word);

            if (isIdentifier) {
                return word;
            }
            return null;
        }

        const identifierSet = new Set();



        CodeMirror.registerHelper("hint", "pseudocode", function(cm) {
            
            if(cm.getValue() != ""){
                
            }

            

            
            const cursor = cm.getCursor();
            const token = cm.getTokenAt(cursor);
            const start = token.start;
            const end = cursor.ch;
            const word = token.string.slice(0, end - start);


            

            const list = keywordList
                .filter(item => item.toUpperCase().startsWith(word.toUpperCase()) || word == "ELSEIF")
                .map(item => ({
                    text: item,
                    render: function(element, self, data) {

   

                        const keywords = ["TO", "FALSE", "TRUE","OUTPUT", "INPUT", "CALL", "DECLARE", "CONSTANT","ELSE","FOR", "NEXT", "STEP", "WHILE", "DO", "ENDWHILE", "REPEAT", "UNTIL", "IF", "THEN", "ELSEIF", "ENDIF", "CASE", "OF", "OTHERWISE", "ENDCASE", "FUNCTION", "PROCEDURE", "RETURN", "RETURNS", "ENDFUNCTION", "ENDPROCEDURE", "OPENFILE", "CLOSEFILE", "READFILE", "WRITEFILE", "READ", "WRITE"];
                        const operators = ["NOT", "AND", "OR", "DIV", "MOD"];
                        const variables = vars;
                        const consts = constants;
                        const prcdrs = procedures;
                        const words = [];
                        const functions = [...["RANDOM","LENGTH", "NUM_TO_STR", "STR_TO_NUM","ROUND", "UCASE", "LCASE", "SUBSTRING", "EOF"], ...methods];
                        const dataTypes = ["ARRAY", "STRING", "INTEGER", "BOOLEAN", "CHAR", "REAL"];

                        const regex = new RegExp(`^(${word})`, "i");
                        const highlighted = item.replace(regex, '<span class="hint-match">$1</span>');
                        
                        
                       
                        if(keywords.includes(item)){
                            element.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" d="M15 4h-5V3h5v1zm-1 3h-2v1h2V7zm-4 0H1v1h9V7zm2 6H1v1h11v-1zm-5-3H1v1h6v-1zm8 0h-5v1h5v-1zM8 2v3H1V2h7zM7 3H2v1h5V3z"/></svg>${highlighted}<span class="hint-type">${item}</span>`;
                        }
                        else if(operators.includes(item)){
                            element.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M2.873 1.1c.335.136.602.398.745.73c.072.17.109.352.107.537a1.34 1.34 0 0 1-.61 1.135a1.359 1.359 0 0 1-.753.223A1.355 1.355 0 0 1 1 2.362a1.355 1.355 0 0 1 .83-1.256A1.37 1.37 0 0 1 2.873 1.1zm-.298 1.765a.551.551 0 0 0 .332-.5a.548.548 0 1 0-.332.5zM6.43 1.109L1.11 6.43l.686.687l5.32-5.32l-.686-.687zM11.5 9h1v2.5H15v1h-2.5V15h-1v-2.5H9v-1h2.5V9zm-5.732.525l.707.707L4.707 12l1.768 1.768l-.707.707L4 12.707l-1.768 1.768l-.707-.707L3.293 12l-1.768-1.768l.707-.707L4 11.293l1.768-1.768zm1.35-4.195a1.353 1.353 0 0 0-1.256-.83a1.355 1.355 0 0 0-1.256.83a1.362 1.362 0 0 0 1.257 1.895A1.358 1.358 0 0 0 7.118 5.33zm-.753.745a.553.553 0 0 1-.289.29a.547.547 0 0 1-.599-.117a.529.529 0 0 1-.117-.173a.544.544 0 0 1 .716-.715a.565.565 0 0 1 .173.116a.549.549 0 0 1 .116.599zM14 3h-4v1h4V3z" clip-rule="evenodd"/></svg>${highlighted}<span class="hint-type">${item}</span>`;
                        }
                        else if(dataTypes.includes(item)){
                            element.innerHTML = `<svg id="name-svg" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M2 5h2V4H1.5l-.5.5v8l.5.5H4v-1H2V5zm12.5-1H12v1h2v7h-2v1h2.5l.5-.5v-8l-.5-.5zm-2.74 2.57L12 7v2.51l-.3.45l-4.5 2h-.46l-2.5-1.5l-.24-.43v-2.5l.3-.46l4.5-2h.46l2.5 1.5zM5 9.71l1.5.9V9.28L5 8.38v1.33zm.58-2.15l1.45.87l3.39-1.5l-1.45-.87l-3.39 1.5zm1.95 3.17l3.5-1.56v-1.4l-3.5 1.55v1.41z" clip-rule="evenodd"/></svg>${highlighted}<span class="hint-type">${item}</span>`;
                        }
                        else if(variables.includes(item)){

                            element.innerHTML = `<svg id="name-svg" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M2 5h2V4H1.5l-.5.5v8l.5.5H4v-1H2V5zm12.5-1H12v1h2v7h-2v1h2.5l.5-.5v-8l-.5-.5zm-2.74 2.57L12 7v2.51l-.3.45l-4.5 2h-.46l-2.5-1.5l-.24-.43v-2.5l.3-.46l4.5-2h.46l2.5 1.5zM5 9.71l1.5.9V9.28L5 8.38v1.33zm.58-2.15l1.45.87l3.39-1.5l-1.45-.87l-3.39 1.5zm1.95 3.17l3.5-1.56v-1.4l-3.5 1.55v1.41z" clip-rule="evenodd"/></svg>${highlighted}<span class="hint-type">DECLARE ${item}: ${varTypeMap.get(item)}</span>`;
                        }
                        else if(consts.includes(item)){

                            element.innerHTML = `<svg id="name-svg" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M2 5h2V4H1.5l-.5.5v8l.5.5H4v-1H2V5zm12.5-1H12v1h2v7h-2v1h2.5l.5-.5v-8l-.5-.5zm-2.74 2.57L12 7v2.51l-.3.45l-4.5 2h-.46l-2.5-1.5l-.24-.43v-2.5l.3-.46l4.5-2h.46l2.5 1.5zM5 9.71l1.5.9V9.28L5 8.38v1.33zm.58-2.15l1.45.87l3.39-1.5l-1.45-.87l-3.39 1.5zm1.95 3.17l3.5-1.56v-1.4l-3.5 1.55v1.41z" clip-rule="evenodd"/></svg>${highlighted}<span class="hint-type">CONSTANT ${item}</span>`;
                        }
                        else if(filenames.includes(`${item}.txt`)){

                            element.innerHTML = `<svg id="name-svg" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M2 5h2V4H1.5l-.5.5v8l.5.5H4v-1H2V5zm12.5-1H12v1h2v7h-2v1h2.5l.5-.5v-8l-.5-.5zm-2.74 2.57L12 7v2.51l-.3.45l-4.5 2h-.46l-2.5-1.5l-.24-.43v-2.5l.3-.46l4.5-2h.46l2.5 1.5zM5 9.71l1.5.9V9.28L5 8.38v1.33zm.58-2.15l1.45.87l3.39-1.5l-1.45-.87l-3.39 1.5zm1.95 3.17l3.5-1.56v-1.4l-3.5 1.55v1.41z" clip-rule="evenodd"/></svg>${highlighted}<span class="hint-type">file name</span>`;
                        }
                        else if(functions.includes(item)){
                            element.innerHTML = `<svg id="function-svg" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" d="m13.51 4l-5-3h-1l-5 3l-.49.86v6l.49.85l5 3h1l5-3l.49-.85v-6L13.51 4zm-6 9.56l-4.5-2.7V5.7l4.5 2.45v5.41zM3.27 4.7l4.74-2.84l4.74 2.84l-4.74 2.59L3.27 4.7zm9.74 6.16l-4.5 2.7V8.15l4.5-2.45v5.16z"/></svg>${highlighted}<span class="hint-type">FUNCTION ${item}</span>`;
                        }
                        else if(prcdrs.includes(item)){
        

                            element.innerHTML = `<svg id="function-svg" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" d="m13.51 4l-5-3h-1l-5 3l-.49.86v6l.49.85l5 3h1l5-3l.49-.85v-6L13.51 4zm-6 9.56l-4.5-2.7V5.7l4.5 2.45v5.41zM3.27 4.7l4.74-2.84l4.74 2.84l-4.74 2.59L3.27 4.7zm9.74 6.16l-4.5 2.7V8.15l4.5-2.45v5.16z"/></svg>${highlighted}<span class="hint-type">PROCEDURE ${item}</span>`;
                        }
                        else{

                            
                            
                            element.innerHTML = `<svg id="name-svg" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M2 5h2V4H1.5l-.5.5v8l.5.5H4v-1H2V5zm12.5-1H12v1h2v7h-2v1h2.5l.5-.5v-8l-.5-.5zm-2.74 2.57L12 7v2.51l-.3.45l-4.5 2h-.46l-2.5-1.5l-.24-.43v-2.5l.3-.46l4.5-2h.46l2.5 1.5zM5 9.71l1.5.9V9.28L5 8.38v1.33zm.58-2.15l1.45.87l3.39-1.5l-1.45-.87l-3.39 1.5zm1.95 3.17l3.5-1.56v-1.4l-3.5 1.55v1.41z" clip-rule="evenodd"/></svg>${highlighted}<span class="hint-type">${item}</span>`;
                        }



                    }
            }));

            const container = document.querySelector('.CodeMirror-hint-active');



            if(container && container != undefined){

                

                container.style.position = "relative";
            }
            
             



            



            window.keywordList = keywordList;

            let returnList = [];
            
            


            if(selectedTab.endsWith('.pseudo') && cm.getValue() != ""){
                returnList = list;
            }

            return {
                    list: returnList,
                    from: CodeMirror.Pos(cursor.line, start),
                    to: CodeMirror.Pos(cursor.line, end)
                };
            
        });

        

        let editor = CodeMirror.fromTextArea(document.getElementById("sourceCode"), {   
            lineNumbers: true,
            lineWrapping: true,
            autoCloseBrackets: true,
            matchBrackets: true,
            mode: "CIEpseudocode",
            theme: window.lightMode == "active" ? "idea" : "darcula",
            foldGutter: true,
            gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],

            foldOptions: {
                rangeFinder: CodeMirror.fold.indent
            },

            extraKeys: {
                "Ctrl-Space": "autocomplete"
            },


        });

        window.editor = editor;

        const cm_docs = new Map();

        const default_doc = CodeMirror.Doc(default_code, "CIEpseudocode");
        const default_txtFile_doc = CodeMirror.Doc("Hello world!", "text/plain");

        cm_docs.set("Main.pseudo", default_doc);
        cm_docs.set("Sample.txt", default_txtFile_doc);

        editor.swapDoc(cm_docs.get("Main.pseudo"));

        editor.getWrapperElement().addEventListener("mouseover", (e) => {

            if(e.target.classList.contains("CodeMirror-foldgutter-open") || e.target.classList.contains("CodeMirror-foldgutter-folded")){

                editor.getWrapperElement().classList.add("show-fold-markers")

            }


        })

        editor.getWrapperElement().addEventListener("mouseout", (e) => {

            const cl = e.target.classList;

            if(cl.contains("CodeMirror-foldgutter-open") || cl.contains("CodeMirror-foldgutter-folded")){

                editor.getWrapperElement().classList.remove("show-fold-markers")

            }


        })

        const FnDescBox = new DescBox();

        function splitWords(text) {
            const result = [];
            // Split by spaces first
            const words = text.split(/\s+/);
            for (const word of words) {
                if (word.includes(',')) {
                    // Split by comma and add each trimmed part
                    for (const part of word.split(',')) {
                        if (part.trim() !== "") result.push(part.trim());
                    }
                } else if (word.trim() !== "") {
                    result.push(word.trim());
                }
            }
            return result;
        }

        const recordWord = debounce(function (cm) {
            
            if(localStorage.getItem("Ac") != "true"){
                return null;
            }

            const word = getCurrentWord(cm);
                if (word) {

                    if(keywordList && !keywordList.includes(word.toUpperCase())){
                        nameSpace.add(word);

                    }
                }
            }, 400);

            editor.on("inputRead", function (cm, change) {

                const cursor = cm.getCursor();
                const lineText = cm.getLine(cursor.line);

                const chars = [...lineText].map((char, index) => ({
                    char,
                    index
                }));


                // Only respond to typing
                if (change.origin === "+input" || change.origin === "paste") {
                    
                    const new_height = parseFloat(getComputedStyle(scrollUsed).height.slice(0,-2));

                    if(new_height < last_scroll_height){

                        scrollBar.style.top = '0px';

                    }

                    

                    

                    recordWord(cm);
                    
                }
                else if(change.origin === "cut"){


                    const new_height = parseFloat(getComputedStyle(scrollUsed).height.slice(0,-2));

                    if(new_height < last_scroll_height){

                        scrollBar.style.top = '0px';

                    }

                }

            });

        let cur_func = '';
        let b_depth = 0;    


        function insertAt(str, index, insert) {
            return str.slice(0, index) + insert + str.slice(index);
        }
        
        let active = false;

        document.addEventListener("keydown", (e) => {

            const cursor = editor.getCursor();
            const lineTokens = editor.getLineTokens(cursor.line).filter(t => t.string.trim() !== '');

            const extra_natives = ["MOD", "DIV"];


            const navigation_keys = ['(', ',', 'ArrowLeft', 'ArrowRight'];

            if(editor.hasFocus() && navigation_keys.includes(e.key)){
                
                

                const lineNumber = editor.getCursor().line;

                const info = editor.lineInfo(lineNumber);

                let construct = info.text;


                construct = insertAt(construct, cursor.ch, '()');

                const trace = construct.substring(0, cursor.ch + 1);

                if(e.key == '('){
                    active = true;
                    const at = trace.split(' ').at(-1).trim().slice(0, -1);

                    if(at && (/(?:SUBSTRING|EOF|NUM_TO_STR|STR_TO_NUM|MOD|DIV|ROUND|RANDOM|LCASE|UCASE|LENGTH)\s*\($/.test(trace))){

                        
                        FnDescBox.tick(at, editor.cursorCoords(), 0);
                        
                    }
                }
                else if(e.key == ','){
                    active = true;
                    const struct = insertAt(info.text, cursor.ch, ',').substring(0, cursor.ch + 1);
                    FnDescBox.countParameters(struct, editor.cursorCoords(),0, 'comma');

                }
                else if(active){

                    const struct = insertAt(info.text, cursor.ch, ',').substring(0, cursor.ch + 1);
                    const params = FnDescBox.countParameters(struct, editor.cursorCoords(),-1, 'arrow');

                    if(params == undefined || params < 0){ 
                        active = false;
                        FnDescBox.close();
                    }

                }
            
            }
            else{

                FnDescBox.close();
                active = false;

            }
            

        })

        



        editor.setOption("hintOptions",{
            hint: CodeMirror.hint.pseudocode
        });

        editor.on("inputRead", function(cm, event) {

            const autocomplete = localStorage.getItem("Ac") === "true";


            if (!cm.state.completionActive && !cm.options.readOnly) {
                CodeMirror.commands.autocomplete(cm, null, { completeSingle: false });
            }
        });



        import {files, pseudoFiles, makeError, running, halt_program} from "./Main.js";
        window.files = files;
        window.pseudoFiles = pseudoFiles;

        function testFileMemory(){

            if(files.size + 1 > maxFiles){
                return false;
            }
            else{
                return true;
            }
        }

        window.testFileMemory = testFileMemory;


        function createNewFile(fileName, contents){

            

            if(fileName == ""){
                return null;
            }

            fileName = adapt_file_name(fileName);



            if(ol_files.includes(fileName)){
                if(confirm(`File '${fileName}' already exists. Would you like to replace it?`)){

                    change_file_contents(fileName, contents);

                }
                else{

                    return null;

                }
            }
            else{
                ol_files.push(fileName);

                files.set(fileName, "");
                const parent = document.getElementById('tabs');
                const unorderedList = parent.querySelector('ul');

                const main = document.getElementsByClassName('Main.pseudo')[0];
                const newTab = main.cloneNode(true);

                newTab.className = fileName;
                newTab.querySelector('a').innerHTML = fileName;


                const button = document.createElement("button");
                button.onclick = function() {
                    event.stopPropagation();
                    removeFile(this);
                };
                button.innerHTML = 'x';

                newTab.insertBefore(button, newTab.lastElementChild);

                unorderedList.insertBefore(newTab, unorderedList.lastElementChild);
                IsolateTabSelection(newTab);



                files.set(fileName, contents);


                IsolateTabSelection(document.getElementsByClassName(fileName)[0]);

                const doc = CodeMirror.Doc(contents, "CIEpseudocode");
                cm_docs.set(fileName, doc);
                editor.swapDoc(doc);
                editor.setValue(contents);
            }





        }

        function IsolateTabSelection(mytab){



            const mytabname = mytab ? mytab.querySelector('a').textContent : "Main.pseudo"




            if(selectedTab != mytabname && mytab){



                files.set(selectedTab, editor.getValue());
                mytab.classList.toggle('selected');
                            
                const anchorTag = mytab.children[0];
                const tabName = anchorTag.innerHTML;
                selectedTab = tabName;
                            
                for(const tab of [...mytab.parentElement.children]){
                    if(tab !== mytab){
                        tab.classList.remove('selected');
                    }
                }

                
                if(!files.get(selectedTab) && selectedTab == "Main.pseudo"){




                    files.set(selectedTab, default_code);


                    
                }

                let newDoc = cm_docs.get(selectedTab);
                if(!newDoc){
                    newDoc = CodeMirror.Doc(files.get(selectedTab), selectedTab.endsWith('.pseudo') ? "CIEpseudocode" : "text/plain");
                    cm_docs.set(selectedTab, newDoc);
                }

                editor.swapDoc(newDoc);
                const titleText = document.getElementById('editorTitle');
                if (titleText) {
                    titleText.textContent = selectedTab;
                }

                build_map(editor.getValue(), selectedTab.endsWith('.txt') );
            }


            
        }

        function removeFile(myTab){
            


            const thisFileName = myTab.parentElement.querySelector('a').innerHTML;

            if(thisFileName == "Main.pseudo"){



            }
            else{
                const i = ol_files.indexOf(thisFileName) - 1;
                ol_files.splice(ol_files.indexOf(thisFileName), 1);


                files.delete(thisFileName);
                pseudoFiles.delete(thisFileName);
                const tab = myTab.parentElement;
                tab.remove();




                
                const newFileName = ol_files[i];

                const newFile = document.getElementsByClassName(newFileName)[0];



                if(selectedTab == thisFileName){
                    IsolateTabSelection(newFile);
                }
            }


            
            
        }

        function remove_file_by_name(thisFileName){

            const myTab = document.getElementsByClassName(thisFileName)[0];

            const i = ol_files.indexOf(thisFileName) - 1;
            ol_files.splice(ol_files.indexOf(thisFileName), 1);


            files.delete(thisFileName);
            pseudoFiles.delete(thisFileName);
            myTab.remove();




            
            const newFileName = ol_files[i];

            const newFile = document.getElementsByClassName(newFileName)[0];



            if(selectedTab == thisFileName){
                IsolateTabSelection(newFile);
            }
        }

        window.removeFile = removeFile;
        window.createNewFile = createNewFile;
        window.IsolateTabSelection = IsolateTabSelection;



        const mainFile = document.getElementsByClassName('Main.pseudo');
        selectedTab = "none";



        IsolateTabSelection(mainFile[0]);
        files.delete("none");
        pseudoFiles.delete("none");


        function extract_token_from_hint(hint) {

            let tk = "";

            const list = hint.split('');

            let i = 0;

            while(list[i].toUpperCase() == list[i]){

                tk += list[i];
                i++;
            }

            return tk;

        }



        import { repl, outputLog, errorLog, errorLines, contexts, pauseLog, err, constants, methods, procedures, namespace} from "/Main.js";
        import {build_map, highlight_error_lines, clear_error_lines} from "/cm_minimap.js";

        
        window.currentTokenMarks = window.currentTokenMarks || [];

        let canHighlightEditor = true;

        editor.on("change" , () => {

            canHighlightEditor = false;
            window.currentTokenMarks.forEach(mark => mark.clear());

        })


        editor.on("cursorActivity", () => {
            
            


            if(selectedTab.endsWith('.txt')) return;

            if(!canHighlightEditor) {
                canHighlightEditor = true;
                return;
            }

            const cursor = editor.getCursor();
            const token = editor.getTokenAt(cursor);

            highlight_all_tokens(editor, window.currentTokenMarks, token);

        })

        document.addEventListener('DOMContentLoaded', () => {
            
            document.body.addEventListener("click", (e) => {

                if(FnDescBox.active && !FnDescBox.descBox.contains(e.target)) FnDescBox.close();

            })


            
            const runBtn = document.getElementById('runBtn');
            const clearBtn = document.getElementById('clearBtn');
            const outLog = document.getElementById('console-content');
            const saveBtn = document.getElementById('saveBtn');
            const loadBtn = document.getElementById('loadBtn');

            clearBtn.addEventListener('click', () => {
                
                function checker() {
                    const result = confirm("Are you sure you want to clear the editor?");
                    if(!result){
                        event.preventDefault();
                    }
                    else{



                        for(const file of [...ol_files]){

                            if(file != "Main.pseudo"){

                                remove_file_by_name(file);

                            }

                        }


                        localStorage.setItem('Saved', default_code); // Store the solution in localStorage

                        if(selectedTab.endsWith('.pseudo')){



                            editor.setValue(default_code);
                        }

                        

                        
                    }
                }

                checker();
            
            
        })


        function getIndexFromPos(editor, pos) {
            let index = 0;

            for (let i = 0; i < pos.line; i++) {
                index += editor.getLine(i).length + 1; // +1 for newline character
            }

            index += pos.ch;

            // Clamp to 0 so we never return -1 / undefined
            if (index - 1 < 0) index = 1;
            return index - 1;
        }




        editor.on('change', (instance) => {


            document.getElementById('mini-map-content').style.whiteSpace = 'normal';

            setTimeout(() => {


                build_map(editor.getValue(), selectedTab.endsWith('.txt'));

            }, 1);
        


            if(!localStorage.getItem('Lg') || localStorage.getItem('Lg') == "true"){
                


                if(!localStorage.getItem('Lg')){

                    
                    localStorage.setItem('Lg', "true");

                }

                const text = editor.getValue();



                const cursor = instance.getCursor();


                const index = getIndexFromPos(instance, cursor);



                function screen_redundant(input) {
                    const toUse = splitWords(input);


                    for(const word of nameSpace){
                        if(!toUse.includes(word)){
                        
                            nameSpace.delete(word);
                        }
                    }

                }



                if(text[index] == '-' && text.length >= 2){


                    

                    for(let i = 0; i < text.length - 1; i++){




                        const potential = text[i]+text[i+1];
                        if(potential == '<-'){

                            
                            const pos = editor.posFromIndex(i);

                            editor.replaceRange('←', pos, {line: pos.line, ch: pos.ch + 2});


                            editor.setCursor({line: pos.line, ch: pos.ch + 1});
                            break;
                        }

                    }   
                }
                else if(text[index] == '=' && text.length >= 2){
                    for(let i = 0; i < text.length - 1; i++){
                        const potential = text[i]+text[i+1];
                        if(potential == '>='){


                            const pos = editor.posFromIndex(i);

                            editor.replaceRange('≥', pos, {line: pos.line, ch: pos.ch + 2});


                            editor.setCursor({line: pos.line, ch: pos.ch + 1});
                            break;
                        }
                        else if(potential == '<='){

                            const pos = editor.posFromIndex(i);

                            editor.replaceRange('≤', pos, {line: pos.line, ch: pos.ch + 2});
                        }
                    }   
                }

                screen_redundant(editor.getValue());

            }


        })

        
        const ln = document.getElementById('Ln');
        const col = document.getElementById('Col');
        const charsSelected = document.getElementById('charsSelected');

        ln.style.color = "var(--accent)";
        col.style.color = "var(--accent)";
        
        
        
        editor.on('cursorActivity', function(instance) {
            
 
            
            
            
            const cursor = instance.getCursor();
            const mousePos = cursor.ch + 1;


            ln.innerHTML = cursor.line + 1;
            col.innerHTML = cursor.ch + 1;

            const selection = editor.getSelection();


            const selection_ranges = editor.listSelections();


            if(selection){


                charsSelected.innerHTML = `(${selection.length} selected)`;
            }
            else{
                charsSelected.innerHTML = "";
            }


        })

        

        runBtn.addEventListener('click', async () => {
            pseudoFiles.clear();


            const consoleParent = document.getElementById('Output');
            consoleParent.classList.remove('Output-error');
            var outLog = document.getElementById('console-content');

            const bar = document.getElementById('progress-bar');
            bar.classList.remove('bar-error');
            bar.classList.remove('bar-success');
            bar.classList.remove('bar-pause');

            outLog.classList.remove("console-error");
            consoleParent.classList.remove("Output-error");
            consoleParent.classList.remove("Output-success");
            consoleParent.classList.remove("Output-pause");
            

            const consoleExt = document.getElementById('console-ext');
            consoleExt.classList.remove('console-error');

            const code = editor.getValue();
            
            files.set(selectedTab, code);

           

            if(!selectedTab.endsWith('.pseudo')){
                alert("The selected file is not of .pseudo type so cannot be run");
            }
            else{
                
                

                if(code !== ""){
                    progam_status = true;
                    
                    clear_console.click();
                    
                
                    const btn = document.getElementById('runBtn');
                    
                    btn.classList.add('runBtn-active');
                    btn.value = "Running...";

                    clear_error_lines();

                    const result = await repl(code, selectedTab, selectedTab,repl_request);
       
                    
                    halt_program(true);

                    btn.classList.remove('runBtn-active');
                    btn.value = "Run";
                    outLog.textContent = "";


                    

                    if(repl_request == "python"){
                        let adapted = "";

                        for(const log of result){



                            adapted = adapted + log;
                            adapted = adapted + '\n';
                        }


 

                        outLog.textContent = adapted;
                    }
                    else if(errorLog.length > 0 && repl_request != "python"){
                        

                        
                    
                        highlight_error_lines(errorLines);

                        let adapted = err == "syntax" ? '' : `Traceback (most recent call last):\n`;

                        for(const log of errorLog){



                            adapted += log;
                            adapted += '\n';
                        }


                        adapted += '\n';

                        outLog.textContent = adapted;


                        if(repl_request == "evaluate" || repl_request == "program"){
                            bar.classList.add('bar-error');
                            consoleParent.classList.add('Output-error');
                            outLog.classList.remove("console-success");
                            outLog.classList.add("console-error");
                        }

                        

                        consoleExt.textContent = "** Process Exited - Return Code: 1 **";



                    }
                    else if(errorLog.length == 0 && outputLog && !consoleExt.textContent.includes("** Process exited - Return Code: 0 **")){



                        for(const log of outputLog){

                            outLog.textContent += log;
                            outLog.textContent += '\n';
                        }


                        outLog.textContent += "\n";


                        if(pauseLog.length > 0){

                            pauseLog.forEach((plog) => {
                                consoleExt.textContent += plog;
                                consoleExt.textContent += '\n';
                            });

                            consoleExt.classList.add('console-error');
                        }
                        else{

                            consoleExt.textContent = "** Process exited - Return Code: 0 **";

                        }

                        


                        if(repl_request == "evaluate" || repl_request == "program"){

                            if(pauseLog.length > 0){

                                consoleParent.classList.add("Output-pause");
                                bar.classList.add('bar-pause');

                            }
                            else{

                                consoleParent.classList.add("Output-success");
                                bar.classList.add('bar-success');

                            }

                        }

                        
                    }

                    else if(errorLog.length == 0 && (!outputLog || outputLog.length == 0)){

                        if(pauseLog.length > 0){

                            pauseLog.forEach((plog) => {
                                consoleExt.textContent += plog;
                                consoleExt.textContent += '\n';
                            });

                            consoleExt.classList.add('console-error');
                        }
                        else{

                            consoleExt.textContent = "** Process exited - Return Code: 0 **";

                        }

                        if(repl_request == "evaluate" || repl_request == "program"){
                            if(pauseLog.length > 0){

                                consoleParent.classList.add("Output-pause");
                                bar.classList.add('bar-pause');

                            }
                            else{

                                consoleParent.classList.add("Output-success");
                                bar.classList.add('bar-success');

                            }
                        }

                        
                        

                        
                    }


                    
 


                    
                }
                else if(errorLog.length == 0){



                    consoleExt.textContent = " \n ** Process exited - Return Code: 0 **";
                }

                consoleParent.scrollTop = consoleParent.scrollHeight;

            }





        });
    });

        saveBtn.addEventListener('click', () => {

            if(editor.getValue() == ""){
                alert("Cannot download empty file!"); 

                return null;
            }



            const fileName = adapt_file_name(prompt("Enter file name:", selectedTab));

            if(!fileName.startsWith("null")){
                const fileContent = editor.getValue();
                const newFile = new Blob([fileContent], {type: 'text/plain'});

                window.URL = window.URL || window.webkitURL;

                const hidden = document.getElementById("hiddenDownload");

                hidden.href = window.URL.createObjectURL(newFile);
                hidden.download = fileName;
                hidden.click();


            }

            save_to_system(fileName, true);

        });

        function change_file_contents(file_name, new_text){

            ol_files[ol_files.indexOf(file_name)] = new_text;

            files.set(file_name, new_text);

            if(selectedTab == file_name){

                editor.setValue(new_text);

            }

        }

        loadBtn.addEventListener('click', () => {

            function openFile() {
                window.showOpenFilePicker({
                    types: [{
                        description: 'Text files',
                        accept: {
                            'text/plain': ['.txt','.pseudo']
                        }
                    }],
                    excludeAcceptAllOption: true,
                    multiple: false,
                })
                .then(([fileHandle]) => {
                    // Save the handle if you want to write later
                    return fileHandle.getFile().then(file => ({
                        content: file.text(),
                        name: file.name
                    }));
                })
                .then(async ({ content, name }) => {
                    const text = await content; // Resolve the file text
                    name = adapt_file_name(name);

                    createNewFile(name, text);


                    const titleText = document.getElementById('editorTitle');
                    if (titleText) {
                        titleText.textContent = name;
                    }


                })
                .catch(error => {
                    console.error("File picking failed:", error);
                });
            }

            if(!testFileMemory()){
                alert(`Maxium ${maxFiles} files can be opened at once!`);
            }
            else{
                openFile();
            }
            

        })

        var clear_console = document.getElementById('clear-console');
        var copy_console = document.getElementById('copy-console');
        var dnld_console = document.getElementById('download-console');

        var cons = document.getElementById('Output');

        clear_console.addEventListener("mouseenter", () => {

            if(cons.textContent == ""){

 

                clear_console.style.cursor = "not-allowed";

            }
            else{

                clear_console.style.cursor = "pointer";

            }

        })


        copy_console.addEventListener("mouseenter", () => {

            if(cons.textContent == "" || outputLog.length == 0){

 

                copy_console.style.cursor = "not-allowed";

            }
            else{

                copy_console.style.cursor = "pointer";

            }

        })


        dnld_console.addEventListener("mouseenter", () => {

            if(cons.textContent == "" || outputLog.length == 0){

 

                dnld_console.style.cursor = "not-allowed";

            }
            else{

                dnld_console.style.cursor = "pointer";

            }

        })

        clear_console.addEventListener("click", () => {

            var cont = document.getElementById('console-content');
            const ext = document.getElementById('console-ext');

            cont.textContent = "";
            ext.textContent = '';

            document.getElementById('Output').classList.remove('Output-error');
            document.getElementById('Output').classList.remove('Output-success');
            document.getElementById('Output').classList.remove('Output-pause');
            document.getElementById('progress-bar').classList.remove('bar-error');
            document.getElementById('progress-bar').classList.remove('bar-success');
            document.getElementById('progress-bar').classList.remove('bar-pause');

        })

        copy_console.addEventListener("click", () => {


            var console_cont = document.getElementById('console-content');


            const error_cond = repl_request == "evaluate" || repl_request == "program" ? errorLog.length == 0 : true;

            if(console_cont.textContent != "" && error_cond){

                let toCopy = "";


                for(const log of outputLog){
                    toCopy += log;
                    toCopy += '\n';
                }


                navigator.clipboard.writeText(toCopy);

                alert("Result copied to clipboard!");

            }

            

        })

        function save_to_system(file, preventMessage){


            files.set(file, editor.getValue());

            const contents = editor.getValue();

            if(file.endsWith('.pseudo')){
                localStorage.setItem("Saved", contents);
            }
            

            if(!preventMessage){
                alert(`File '${file}' saved successfully!`);
            }
            

            hasSaved = true;


        }




        async function saveTextFile(defaultName, contents) {
            // Prompt user for a file handle
            const opts = {
                suggestedName: defaultName,
                types: [
                    {
                        description: 'Text Files',
                        accept: {'text/plain': ['.txt']},
                    },
                ],
            };

            try {
                // showSaveFilePicker opens a native save dialog
                const fileHandle = await (window).showSaveFilePicker(opts);
                
                // Create a writable stream
                const writable = await fileHandle.createWritable();
                
                // Write contents
                await writable.write(contents);
                
                // Close the file and save
                await writable.close();


            } catch (err) {
                console.error('File save cancelled or failed:', err);
            }
        }

        async function saveJSONFile(defaultName, contents) {
            // Prompt user for a file handle
            const opts = {
                suggestedName: defaultName,
                types: [
                    {
                        description: 'JSON Files',
                        accept: {'text/plain': ['.json']},
                    },
                ],
            };

            try {
                // showSaveFilePicker opens a native save dialog
                const fileHandle = await (window).showSaveFilePicker(opts);
                
                // Create a writable stream
                const writable = await fileHandle.createWritable();
                
                // Write contents
                await writable.write(contents);
                
                // Close the file and save
                await writable.close();


            } catch (err) {
                console.error('File save cancelled or failed:', err);
            }
        }

        async function savePyFile(defaultName, contents) {
            // Prompt user for a file handle



            const opts = {
                suggestedName: defaultName,



                types: [
                    {
                        description: 'Python Files',
                        accept: {'text/x-python': ['.py']},
                    },
                ],
            };

            try {
                // showSaveFilePicker opens a native save dialog
                const fileHandle = await (window).showSaveFilePicker(opts);
                
                // Create a writable stream
                const writable = await fileHandle.createWritable();
                
                // Write contents
                await writable.write(contents);
                
                // Close the file and save
                await writable.close();


            } catch (err) {
                console.error('File save cancelled or failed:', err);
            }
        }


        function removeSuffix(str, suffix) {
            if (str.endsWith(suffix)) {
                return str.slice(0, str.length - suffix.length);
            }
            return str;
        }




        dnld_console.addEventListener("click", () => {

            var console = document.getElementById('console-content');
            

            if(outputLog.length > 0 && console.textContent != ""){
                let toCopy = "";


                for(const log of outputLog){
                    toCopy += log;
                    toCopy += '\n';
                }

                const fn = removeSuffix(selectedTab, ".pseudo") + '_output';

                switch(repl_request){


                    case "python":

                        if(localStorage.getItem("dpf") === "true"){

                            savePyFile(fn, toCopy);
                        

                        }
                        else{

                            saveTextFile(fn, toCopy);

                        }

                        break;

                        
                    default:
                        saveTextFile(fn, toCopy);
                        break;
                }

                
            }


            

        })



        var youtube_link = document.getElementById('youtube');
        //var discord_link = document.getElementById('discord');



        youtube_link.addEventListener("click", function() {

            window.open("https://www.youtube.com/channel/UC6VWHFdjnb8rL_nQMMttALw");

        })

        /*
        discord_link.addEventListener("click", function() {


            window.open("https://discord.gg/BnqYh3HbBN");

        })*/


        document.getElementById('github').addEventListener("click", () => {

            window.open("https://github.com/thinukshankodithuwakku/Pseudowhizz");

        })


        document.addEventListener("DOMContentLoaded", () => {
            document.addEventListener("keydown", function(e) {
                if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "s") {
                    e.preventDefault();
                    if(editor.getValue() == ""){
                        throw "Cannot save empty file!";
                    }
                    else{
                        document.getElementById('saveBtn').click();
                    }
                }
                else if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "o") {
                    e.preventDefault();
                    if(!testFileMemory()){
                        alert(`Maxium ${maxFiles} files can be opened at once!`);
                    }
                    else{
                        document.getElementById('loadBtn').click();
                    }
                }
                else if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'enter'){
                    e.preventDefault();
                    document.getElementById('runBtn').click();
                }
            });
        });

        

        
        

        window.addEventListener("beforeunload", function (e) {

            


            if(!hasSaved && (editor.getValue() != localStorage.getItem("Default"))){
                e.preventDefault();
                e.returnValue = ""; // Required for Chrome

                fetch('/Prewritten/Default.txt')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.text(); // Use .json() if it's JSON
                    })
                    .then(data => {
                        localStorage.setItem("Default", data);
                    })
                    .catch(error => {
                        console.error("Error fetching file:", error);
                    });
            }




        });



        function rename_file(originalName, newName){

            ol_files[ol_files.indexOf(originalName)] = newName;




            const tabEl = document.getElementsByClassName(originalName)[0];

            if(!tabEl){
                alert(`File '${originalName}' does not exist!`);
                return null;
            }
            else{

                const originalContents = files.get(originalName);

                files.set(newName, originalContents);

                files.delete(originalName);
                pseudoFiles.delete(originalName);

                if(selectedTab == originalName){
                    
                    selectedTab = newName;
                }
                

                tabEl.querySelector('a').textContent = newName;



                const titleText = document.getElementById('editorTitle');
                if (titleText && titleText.textContent == originalName) {
                    titleText.textContent = newName;
                }

                tabEl.classList.remove(originalName);
                tabEl.classList.add(newName);


            }

            

        }

        function extract_file_type(raw) {

            let guess = "";

            raw = raw.split('');

            let i = raw.length - 1;

            if(!raw.includes('.')){

                return 'none';

            }
            else{
                while(raw[i] != '.'){

                    guess = raw[i] + guess;
                    i--;

                }

                return guess;
            }



        }


        function extract_file_name(raw) {

            let guess = "";

            raw = raw.split('');

            let i = 0;

            if(!raw.includes('.')){

                return 'none';

            }
            else{
                while(raw[i] != '.'){

                    guess += raw[i];
                    i++;

                }

                return guess;
            }



        }

        function adapt_file_name(raw){

            const typ = extract_file_type(raw);

            if(typ == "none"){

                return raw + '.txt';

            }
            else if(typ == "psc"){

                return extract_file_name(raw) + '.pseudo';

            }
            else if(typ == "pseudo" || typ == "txt"){

                return raw;

            }
            else{

                return extract_file_name(raw) + '.txt'; 

            }


        }


        document.addEventListener('keydown', function(e) {


            if (e.code === 'F2' || e.key === "AudioVolumeDown") {
 
                e.preventDefault();

                const org = prompt("Enter the name of the file to rename: ");

                if(org === null || org === ""){

                    return null;

                }

                let newName = prompt("Enter the new file name: ");

                if(newName === null || newName === ""){
                    return null;
                }

                if(extract_file_type(newName) == 'none'){

                    newName += '.' + extract_file_type(org);
                    rename_file(org, newName);

                }
                else{

                    rename_file(org, newName);

                }

                

            }
        }, true);


        const hammenu = document.getElementsByClassName('ham')[0];
        const offscreenmenu = document.getElementById('mobile-nav-list');



        hammenu.addEventListener("click", ()=> {

            hammenu.classList.toggle('active');
            offscreenmenu.classList.toggle('active');

            document.getElementById('mobile-navbox').focus();


        })

        const links = document.getElementsByClassName('current-tab');

        for(const link of links){

            link.addEventListener("click", () => {

                hammenu.classList.toggle('active');
                offscreenmenu.classList.toggle('active');

            })

        }

        




        


        
        const font_selection = document.getElementById('fonts');

        font_selection.addEventListener("change", () => {
 

            document.documentElement.style.setProperty('--editor-font-fam', "'Courier New', Courier, monospace");
            localStorage.setItem("font-fam", "'Courier New', Courier, monospace");

            switch(font_selection.value){

                case "cascadia-optn":
                    document.documentElement.style.setProperty('--editor-font-fam', "cascadia, Courier, monospace");
                    localStorage.setItem("font-fam", "cascadia, Courier, monospace");
                    return;

                case "consolas-optn":
                    document.documentElement.style.setProperty('--editor-font-fam', "consolas, Courier, monospace");
                    localStorage.setItem("font-fam", "consolas, Courier, monospace");
                    return;

                case "monospace-optn":
                    document.documentElement.style.setProperty('--editor-font-fam', "monospace");
                    localStorage.setItem("font-fam", "monospace");
                    return;

                case "jetbrains-mono-optn":
                    document.documentElement.style.setProperty('--editor-font-fam', "'jetbrains', Courier, monospace");
                    localStorage.setItem("font-fam", "'jetbrains', Courier, monospace");
                    return;

                case "brass-mono-optn":
                    document.documentElement.style.setProperty('--editor-font-fam', "brass, Courier, monospace");
                    localStorage.setItem("font-fam", "brass, Courier, monospace");
                    return;

                case "kode-mono-optn":
                    document.documentElement.style.setProperty('--editor-font-fam', "kode, Courier, monospace");
                    localStorage.setItem("font-fam", "kode, Courier, monospace");
                    return;

                case "sans-serif-optn":
                    document.documentElement.style.setProperty('--editor-font-fam', "sans-serif, Courier, monospace");
                    localStorage.setItem("font-fam", "sans-serif, Courier, monospace");
                    return;

                default:
                    document.documentElement.style.setProperty('--editor-font-fam', "'Courier New', Courier, monospace");
                    localStorage.setItem("font-fam", "'Courier New', Courier, monospace");

            }

        })



        

        /*courier.addEventListener("click", () => {

            show_fonts.innerHTML = "Courier New ▾";
            document.documentElement.style.setProperty('--editor-font-fam', "'Courier New', Courier, monospace");
            localStorage.setItem("font-fam", "'Courier New', Courier, monospace");
            show_fonts.click();
            select_font("courier");
        })

        cascadia.addEventListener("click", () => {

            show_fonts.innerHTML = "Cascadia ▾";
            document.documentElement.style.setProperty('--editor-font-fam', "cascadia, Courier, monospace");
            localStorage.setItem("font-fam", "cascadia, Courier, monospace");
            show_fonts.click();
            select_font("cascadia");
        })

        consolas.addEventListener("click", () => {

            show_fonts.innerHTML = "Consolas ▾";
            document.documentElement.style.setProperty('--editor-font-fam', "consolas, Courier, monospace");
            localStorage.setItem("font-fam", "consolas, Courier, monospace");
            show_fonts.click();
            select_font("consolas");
        })

        jetbrains.addEventListener("click", () => {

            show_fonts.innerHTML = "JetBrains Mono ▾";
            document.documentElement.style.setProperty('--editor-font-fam', "'jetbrains', Courier, monospace");
            localStorage.setItem("font-fam", "'jetbrains', Courier, monospace");
            show_fonts.click();
            select_font("'jetbrains'");
        })

        sans_serif.addEventListener("click", () => {

            show_fonts.innerHTML = "Sans Serif ▾";
            document.documentElement.style.setProperty('--editor-font-fam', "sans-serif, Courier, monospace");
            localStorage.setItem("font-fam", "sans-serif, Courier, monospace");
            show_fonts.click();
            select_font("sans-serif");

        })

        monospace.addEventListener("click", () => {

            show_fonts.innerHTML = "Monospace ▾";
            document.documentElement.style.setProperty('--editor-font-fam', "monospace");
            localStorage.setItem("font-fam", "monospace");
            show_fonts.click();
            select_font("monospace");

        })*/



        

        /*const menu = document.getElementById('repl-nodes');
        const cur = document.getElementById('output-mode-panel');
        const con = document.getElementById('output-mode-container');

        menu.style.display = "none";

        cur.addEventListener("click", () => {

            if(menu.style.display == "none"){

                menu.style.display = "flex";
                cur.innerHTML = cur.innerHTML.slice(0,-1) + '▴';

                con.style.borderBottomLeftRadius = "0px";
                con.style.borderBottomRightRadius = "0px";
            }
            else{
                menu.style.display = "none";
                cur.innerHTML = cur.innerHTML.slice(0,-1) + '▾';

                con.style.borderBottomLeftRadius = "5px";
                con.style.borderBottomRightRadius = "5px";
            }

            

        });*/

        const output_modes = document.getElementById('repl-nodes');

        output_modes.addEventListener("change", () => {

            repl_request = output_modes.value;

            if(output_modes.value == "program"){

                localStorage.setItem("output-mode", "evaluate");

            }
            else{
                localStorage.setItem("output-mode", output_modes.value);

            }

            

        })

        /*function switch_to_mode(mode) {

            return;

            switch(mode){

                case "evaluate":
                    repl_request = "program";
                    cur.innerHTML = "Evaluate ▾";
                    menu.style.display = "none";

                    con.style.borderBottomLeftRadius = "5px";
                    con.style.borderBottomRightRadius = "5px";

                    document.getElementById('repl-evaluate').innerHTML = "Evaluate ✓";
                    document.getElementById('repl-tokenise').innerHTML = "Tokenise";
                    document.getElementById('repl-ast').innerHTML = "Abstract Syntax Tree";
                    document.getElementById('repl-python').innerHTML = "Python";

                    return null;

                case "tokens":
                    repl_request = "tokens";
                    cur.innerHTML = "Tokenise ▾";
                    menu.style.display = "none";

                    con.style.borderBottomLeftRadius = "5px";
                    con.style.borderBottomRightRadius = "5px";

                    document.getElementById('repl-evaluate').innerHTML = "Evaluate";
                    document.getElementById('repl-tokenise').innerHTML = "Tokenise ✓";
                    document.getElementById('repl-ast').innerHTML = "Abstract Syntax Tree";
                    document.getElementById('repl-python').innerHTML = "Python";

                    return null;

                case "ast":
                    repl_request = "ast";
                    cur.innerHTML = "Abstract Syntax Tree ▾";
                    menu.style.display = "none";

                    con.style.borderBottomLeftRadius = "5px";
                    con.style.borderBottomRightRadius = "5px";

                    document.getElementById('repl-evaluate').innerHTML = "Evaluate";
                    document.getElementById('repl-tokenise').innerHTML = "Tokenise";
                    document.getElementById('repl-ast').innerHTML = "Abstract Syntax Tree ✓";
                    document.getElementById('repl-python').innerHTML = "Python";

                    return null;

                case "python":
                    repl_request = "python";
                    cur.innerHTML = "Python ▾";
                    menu.style.display = "none";

                    con.style.borderBottomLeftRadius = "5px";
                    con.style.borderBottomRightRadius = "5px";

                    document.getElementById('repl-evaluate').innerHTML = "Evaluate";
                    document.getElementById('repl-tokenise').innerHTML = "Tokenise";
                    document.getElementById('repl-ast').innerHTML = "Abstract Syntax Tree";
                    document.getElementById('repl-python').innerHTML = "Python ✓";

                    return null;

                default:
                    return null;
            }

        }*/


        

        const dropdown = document.getElementById('request-dropdown');
        const next = document.getElementById('theme-toggle-container');
        const parent = document.getElementById('menu-right');


        
        function toggle_request_dropdown(){
            if(dropdown && window.innerWidth <= 650){
                dropdown.remove();
            }
            else if(dropdown){
            
                parent.insertBefore(dropdown, next);
                
            }
        }



        const cog = document.getElementById("settings");
        const shareIcon = document.getElementById('share-btn');
        const fullScreen = document.getElementById('fullscreen-btn');
        const widescreen = document.getElementById('widescreen-only');


        const ws_parent = widescreen.parentNode;
        const ws_nextSibling = widescreen.nextSibling;

        let open = document.getElementById('widescreen-only');
        let open_share = document.getElementById('share-btn');



        const fsSqr = fullScreen.querySelector('.fs-col');
        const efsSqr = fullScreen.querySelector('.efs-col');
        efsSqr.style.display = "none";
        fsSqr.style.display = "flex";

        document.addEventListener("fullscreenchange", () => {

            if (!document.fullscreenElement) {
                
                fullScreen.title = "Enter Fullscreen";
                efsSqr.style.display = "none";
                fsSqr.style.display = "flex";

            } else {
                if (document.exitFullscreen) {
                    
                    fullScreen.title = "Exit Fullscreen";
                    fsSqr.style.display = "none";
                    efsSqr.style.display = "flex";

                }

            }

        })

        fullScreen.addEventListener("click", () => {

            if (!document.fullscreenElement) {
                document.getElementById('underlay').requestFullscreen();

            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();

                }
            }

        });

        cog.addEventListener("click", (e) =>{




            toggle_sym_col();
            document.getElementById('settings-modal').showModal();

        })

        let mbl_link = document.getElementById('settings-mbl-li');
        let share_link = document.getElementById('share-mbl-li');
        let fs_link = document.getElementById('fullscreen-mbl-li');
        let mbl_menu = document.getElementById('mobile-nav-list');

        fs_link.addEventListener("click", () => {

            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                
                fs_link.querySelector('#fullscreen-mbl').textContent = "Exit Fullscreen";

            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                    fs_link.querySelector('#fullscreen-mbl').textContent = "Enter Fullscreen";
                }
            }

        });


        mbl_link.addEventListener("click", () =>{

            document.getElementById('settings-modal').showModal();

        })

        let mbl_last = share_link.nextSibling;

        function configureCog() {
            if (window.innerWidth < 445) {

                if (widescreen.parentNode) {
                    ws_parent.removeChild(widescreen);

                    open = undefined;


                }
            } else {

                if (!widescreen.parentNode) {



                    ws_parent.insertBefore(widescreen, ws_nextSibling);
                    open = document.getElementById('widescreen-only');


                }
            }
        }

        function configureMobileSettingsLink() {
            if (window.innerWidth > 445) {


                if (mbl_link && mbl_link.parentNode) {
                    mbl_menu.removeChild(mbl_link);
                    mbl_menu.removeChild(share_link);
                    mbl_menu.removeChild(fs_link);

                }
            } else {

                if (!mbl_link.parentNode) {

               

                    mbl_menu.insertBefore(mbl_link, mbl_last);
                    mbl_menu.insertBefore(share_link, mbl_last);
                    mbl_menu.insertBefore(fs_link, mbl_last);
                    
                }
            }


        }

        function configure_settingsLocation(){

            configureCog();
            configureMobileSettingsLink();



        }

        configure_settingsLocation();

        if(document.getElementById('share-mbl')){
            document.getElementById('share-mbl').addEventListener("click", () => {

            
                document.getElementById('pre-gen').style.display = "flex";
                document.getElementById('gen').style.display = "none";

                

                const p_name = document.getElementById('project-name');

                p_name.value = selectedTab == "Main.pseudo" ? "MyProject.pseudo" : selectedTab;;
                p_name.select();
                p_name.setSelectionRange(0, 99999); // For mobile devices

                document.getElementById('share-modal').showModal();

            });
        }

        window.addEventListener("resize", () => {

            
            const next = document.getElementById('theme-toggle-container');
            const parent = document.getElementById('menu-right');

            configure_settingsLocation();

            if(document.getElementById('share-btn')){
                document.getElementById('share-btn').addEventListener("click", () => {

                
                    document.getElementById('pre-gen').style.display = "flex";
                    document.getElementById('gen').style.display = "none";

                    

                    const p_name = document.getElementById('project-name');

                    p_name.value = selectedTab == "Main.pseudo" ? "MyProject.pseudo" : selectedTab;;
                    p_name.select();
                    p_name.setSelectionRange(0, 99999); // For mobile devices

                    document.getElementById('share-modal').showModal();

                });
            }

            if(document.getElementById('share-mbl')){
                document.getElementById('share-mbl').addEventListener("click", () => {

                
                    document.getElementById('pre-gen').style.display = "flex";
                    document.getElementById('gen').style.display = "none";

                    

                    const p_name = document.getElementById('project-name');

                    p_name.value = selectedTab == "Main.pseudo" ? "MyProject.pseudo" : selectedTab;
                    p_name.select();
                    p_name.setSelectionRange(0, 99999); // For mobile devices

                    document.getElementById('share-modal').showModal();

                });
            }
            

        })

        const modal = document.getElementById('settings-modal');

        

        
        if(open){
            document.getElementById('settings').addEventListener("click", () => {
                        
                modal.showModal();

            })
        }

        

        const Ln_toggle = document.getElementById('Ln-toggle');
        const Lw_toggle = document.getElementById('Lw-toggle');
        const Ac_toggle = document.getElementById('Ac-toggle');
        const Lg_toggle = document.getElementById('Lg-toggle');

        const font_size = document.getElementById('font-size');
        const dpf_toggle = document.getElementById('dpf-toggle');
        const Af_toggle = document.getElementById('Af-toggle');
        const Mmp_toggle = document.getElementById('Mmp-toggle');
        const flmd_toggle = document.getElementById('Flmd-toggle');


        const keyword = document.getElementById('keyword-highlight');
        const datatype = document.getElementById('dt-highlight');
        const other = document.getElementById('other-highlight');
        const identifier = document.getElementById('ident-highlight');
        const constant = document.getElementById('const-highlight');
        const operator = document.getElementById('op-highlight');
        const bool = document.getElementById('bool-highlight');
        const fn = document.getElementById('fn-highlight');
        const str = document.getElementById('string-highlight');
        const char = document.getElementById('char-highlight');
        const num = document.getElementById('num-highlight');
        const cmnt = document.getElementById('cmnt-highlight');
        const symbol = document.getElementById('sym-highlight');

        function toggle_sym_col(){
            
            document.documentElement.style.setProperty('--symbols', symbol.value);

            if(localStorage.getItem("lightMode") == "active"){


                if(symbol.value == '#839496' && !localStorage.getItem("symbol")){

                    symbol.value = '#383838';
                    document.documentElement.style.setProperty('--symbols', symbol.value);
                }

            }
            else{

                if(symbol.value == '#383838' && !localStorage.getItem("symbol")){

                    symbol.value = "#839496";
                    document.documentElement.style.setProperty('--symbols', symbol.value);
                }

            }


        }

        Ac_toggle.checked = !localStorage.getItem("Ac") || localStorage.getItem("Ac") === "true";

        Lg_toggle.checked = !localStorage.getItem("Lg") || localStorage.getItem("Lg") === "true";

        Ln_toggle.checked = !localStorage.getItem("Ln") || localStorage.getItem("Ln") === "true";

        Lw_toggle.checked = !localStorage.getItem("Lw") || localStorage.getItem("Lw") === "true";

        dpf_toggle.checked = !localStorage.getItem("dpf") || localStorage.getItem("dpf") == "true"

        Mmp_toggle.checked = !localStorage.getItem("Mmp") || localStorage.getItem("Mmp") == "true";

        flmd_toggle.checked = localStorage.getItem("Flmd") == "true";

        font_size.value = localStorage.getItem("font-size") ? localStorage.getItem("font-size") : 13;

        if(!localStorage.getItem("font-size")) localStorage.setItem("font-size", 13);

        Af_toggle.checked = localStorage.getItem("Af") && localStorage.getItem("Af") === "true";

        Ln_toggle.addEventListener("change", function() {

            localStorage.setItem("Ln", String(Ln_toggle.checked));

            editor.setOption("lineNumbers", Ln_toggle.checked);

        })

        Ac_toggle.addEventListener("change", function() {

            localStorage.setItem("Ac", Ac_toggle.checked);


            if(Ac_toggle.checked){
                editor.setOption("hintOptions",{
                    hint: CodeMirror.hint.pseudocode
                });
            }
            else{
                editor.setOption("hintOptions",null);
            }
            

        })

        Lg_toggle.addEventListener("change", () => {


            localStorage.setItem("Lg", Lg_toggle.checked);

        })

        dpf_toggle.addEventListener("change", () => {

            localStorage.setItem("dpf", dpf_toggle.checked);

        })

        Mmp_toggle.addEventListener("change", () => {


            localStorage.setItem("Mmp", Mmp_toggle.checked);

            if(Mmp_toggle.checked){

                document.documentElement.style.setProperty('--editor-portion', '90%');
                document.getElementById('mini-map-collumn').style.display = "flex";
            }
            else{

                document.documentElement.style.setProperty('--editor-portion', '100%');
                document.getElementById('mini-map-collumn').style.display = "none";
            }

            


        })

        flmd_toggle.addEventListener("change", () => {


            localStorage.setItem("Flmd", flmd_toggle.checked);

        })

        font_size.addEventListener("change", function() {

            if(font_size.value < 5){

                font_size.value = 5;

            }

            localStorage.setItem("font-size", String(font_size.value));
            document.documentElement.style.setProperty('--editor-font-size', font_size.value + 'px');
            editor.refresh();
      
        })

        Af_toggle.addEventListener("change", function(){

            localStorage.setItem("Af", Af_toggle.checked);

        })



        keyword.addEventListener("change", function() {

            localStorage.setItem("keyword", keyword.value);
            document.documentElement.style.setProperty('--keyword', keyword.value);

        })

        datatype.addEventListener("change", function() {

            localStorage.setItem("datatype", datatype.value);
            document.documentElement.style.setProperty('--datatype', datatype.value);

        })

        other.addEventListener("change", function() {

            localStorage.setItem("other", other.value);
            document.documentElement.style.setProperty('--other', other.value);

        })

        bool.addEventListener("change", function() {

            localStorage.setItem("bool", bool.value);
            document.documentElement.style.setProperty('--boolean', bool.value);

        })

        operator.addEventListener("change", function() {

            localStorage.setItem("operator", operator.value);
            document.documentElement.style.setProperty('--operator',operator.value);

        })


        identifier.addEventListener("change", function() {

            localStorage.setItem("identifier", identifier.value);
            document.documentElement.style.setProperty('--variable', identifier.value);

        })

        constant.addEventListener("change", function() {


            localStorage.setItem("const", constant.value);
            document.documentElement.style.setProperty('--constant', constant.value);

        })

        fn.addEventListener("change", function() {

            localStorage.setItem("fn", fn.value);
            document.documentElement.style.setProperty('--native', fn.value);

        })

        str.addEventListener("change", function() {

            localStorage.setItem("str", str.value);
            document.documentElement.style.setProperty('--string', str.value);

        })

        char.addEventListener("change", function() {

            localStorage.setItem("char", char.value);
            document.documentElement.style.setProperty('--char', char.value);

        })

        num.addEventListener("change", function() {

            localStorage.setItem("num", num.value);
            document.documentElement.style.setProperty('--number', num.value);


        })

       cmnt.addEventListener("change", function() {

            localStorage.setItem("cmnt", cmnt.value);
            document.documentElement.style.setProperty('--comments', cmnt.value);

            
        })

        symbol.addEventListener("change", function() {


            localStorage.setItem("symbol", symbol.value);
            document.documentElement.style.setProperty('--symbols', symbol.value);
            
        })


        function MK_Colour(type){



            let def = "";

            switch(type){

                case "keyword":
                    def = "#4793ee"
                    break;

                case "other":
                    def = "#BD86B7"
                    break;

                case "datatype":
                    def = "#4DB5A1";
                    break;

                case "identifier":
                    def = "#98D6EE";
                    break;

                case "const":
                    def = "#41A4CE";
                    break;

                case "fn":
                    def = "#d2d68a";
                    break;

                case "operator":
                    def = "#d2d68a";
                    break;

                case "bool":
                    def = "#4793ee";
                    break;

                case "str":
                    def = "#CE916C";
                    break;

                case "char":
                    def = "#CE916C";
                    break;

                case "num":
                    def = "#ACC5A2";
                    break;

                case "cmnt":
                    def = "#609955";
                    break;


                case "symbol":

                    def = "#839496";
                    
                    document.documentElement.style.setProperty('--symbols', "var(--text-color)");

                    break;

                default:
                    def = "var(--accent-colour)"

            }

            if(!localStorage.getItem(type)){
                localStorage.setItem(type, def);
            }

            return localStorage.getItem(type) && localStorage.getItem(type) !== "" ? localStorage.getItem(type) : def;


        }

        function set_repl_request(){

        

            repl_request = localStorage.getItem("output-mode") == "evaluate" ? "program" : localStorage.getItem("output-mode");

        }

        function refresh_settings(){

            if(!localStorage.getItem("Ln")){

                localStorage.setItem("Ln", "true");
                Ln_toggle.checked = true;

            }

            if(!localStorage.getItem("Lw")){

                localStorage.setItem("Lw", "true");
                Lw_toggle.checked = true;

            }

            if(!localStorage.getItem("Ac")){

                localStorage.setItem("Ac", "true");
                Ac_toggle.checked = true;

            }

            if(!localStorage.getItem("Lg")){

                localStorage.setItem("Lg", "true");
                Lg_toggle.checked = true;

            }

            if(!localStorage.getItem("dpf")){

                localStorage.setItem("dpf", "true");
                dpf_toggle.checked = true;

            }

            if(!localStorage.getItem("Mmp")){

                localStorage.setItem("Mmp", "true");
                Mmp_toggle.checked = true;

            }



            if(!localStorage.getItem("Flmd")){

                localStorage.setItem("Flmd", "false");
                flmd_toggle.checked = false;

            }

            editor.setOption("lineNumbers", Ln_toggle.checked);

            editor.setOption("lineWrapping", Lw_toggle.checked);

            if(!localStorage.getItem("output-mode")){

                localStorage.setItem("output-mode", "evaluate");

            }


            set_repl_request(); 
            

            if(localStorage.getItem("output-mode") == "evaluate"){

                document.getElementById('repl-nodes').value = "program";

            }
            else{

                document.getElementById('repl-nodes').value = localStorage.getItem("output-mode");
            }

            keyword.value = MK_Colour("keyword");
            datatype.value = MK_Colour("datatype");
            other.value = MK_Colour("other");
            identifier.value = MK_Colour("identifier");
            constant.value = MK_Colour("const");
            fn.value = MK_Colour("fn");
            str.value = MK_Colour("str");
            char.value = MK_Colour("char");
            num.value = MK_Colour("num");
            cmnt.value = MK_Colour("cmnt");
            symbol.value = MK_Colour("symbol");
            operator.value = MK_Colour("operator");
            bool.value = MK_Colour("bool");
   

            document.documentElement.style.setProperty('--keyword', keyword.value);
            document.documentElement.style.setProperty('--datatype', datatype.value);
            document.documentElement.style.setProperty('--other', other.value);
            document.documentElement.style.setProperty('--variable', identifier.value);
            document.documentElement.style.setProperty('--constant', constant.value);
            document.documentElement.style.setProperty('--native', fn.value);
            document.documentElement.style.setProperty('--string', str.value);
            document.documentElement.style.setProperty('--char', char.value);
            document.documentElement.style.setProperty('--number', num.value);
            document.documentElement.style.setProperty('--comments', cmnt.value);
            document.documentElement.style.setProperty('--symbols', symbol.value);
            document.documentElement.style.setProperty('--operator', operator.value);
            document.documentElement.style.setProperty('--boolean', bool.value);

            

            let font_size = localStorage.getItem("font-size");

            if(!font_size){

                localStorage.setItem("font-size", "13");

            }

            document.documentElement.style.setProperty('--editor-font-size', localStorage.getItem("font-size") + 'px');

            let font = localStorage.getItem("font-fam");

            if(!font){

                localStorage.setItem("font-fam" ,"'Courier New', Courier, monospace");
                font = "'Courier New', Courier, monospace";

            }

            document.documentElement.style.setProperty('--editor-font-fam', font);
            
            switch(font){

                

                case "cascadia, Courier, monospace":
                    font_selection.value = "cascadia-optn";
                    return;

                case "consolas, Courier, monospace":
                    font_selection.value = "consolas-optn";
                    return;

                case "monospace":
                    font_selection.value = "monospace-optn";
                    return;

                case "'jetbrains', Courier, monospace":
                    font_selection.value = "jetbrains-mono-optn";
                    return;

                case "brass, Courier, monospace":
                    font_selection.value = "brass-mono-optn";
                    break;

                case "kode, Courier, monospace":
                    font_selection.value = "kode-mono-optn";
                    break;

                case "sans-serif, Courier, monospace":
                    font_selection.value = "sans-serif-optn";
                    break;

                default:
                    font_selection.value = "courier-optn";
            }

            

            


            
            toggle_sym_col();
        }

        refresh_settings();

        document.getElementById('keyword-col-reset').addEventListener("click", () => {

            keyword.value = "#4793ee";
            localStorage.setItem("keyword", keyword.value);
            document.documentElement.style.setProperty('--keyword', keyword.value);

        })

        document.getElementById('dt-col-reset').addEventListener("click", () => {

            datatype.value = "#4DB5A1";
            localStorage.setItem("datatype", datatype.value);
            document.documentElement.style.setProperty('--datatype', datatype.value);

        })

        document.getElementById('other-col-reset').addEventListener("click", () => {

            other.value = "#BD86B7";
            localStorage.setItem("other", other.value);
            document.documentElement.style.setProperty('--other', other.value);

        })

        document.getElementById('bool-col-reset').addEventListener("click", () => {

            bool.value = "#4793ee";
            localStorage.setItem("bool", bool.value);
            document.documentElement.style.setProperty('--boolean', bool.value);

        })

        document.getElementById('ident-col-reset').addEventListener("click", () => {

            identifier.value = "#98D6EE";
            localStorage.setItem("identifier", identifier.value);
            document.documentElement.style.setProperty('--variable', identifier.value);

        })

        document.getElementById('const-col-reset').addEventListener("click", () => {

            constant.value = "#41A4CE";
            localStorage.setItem("const", constant.value);
            document.documentElement.style.setProperty('--constant', constant.value);

        })

        document.getElementById('op-col-reset').addEventListener("click", () => {

            operator.value = "#d2d68a";
            localStorage.setItem("operator",operator.value);
            document.documentElement.style.setProperty('--operator', operator.value);

        })

        document.getElementById('fn-col-reset').addEventListener("click", () => {

            fn.value = "#d2d68a";
            localStorage.setItem("fn",fn.value);
            document.documentElement.style.setProperty('--native', fn.value);

        })

        document.getElementById('string-col-reset').addEventListener("click", () => {

            str.value = "#CE916C";
            localStorage.setItem("str",str.value);
            document.documentElement.style.setProperty('--string', str.value);

        })

        document.getElementById('char-col-reset').addEventListener("click", () => {

            char.value = "#CE916C";
            localStorage.setItem("char",char.value);
            document.documentElement.style.setProperty('--char', char.value);

        })

        document.getElementById('num-col-reset').addEventListener("click", () => {

            num.value = "#ACC5A2";
            localStorage.setItem("num",num.value);
            document.documentElement.style.setProperty('--number', num.value);

        })

        document.getElementById('cmnt-col-reset').addEventListener("click", () => {

            cmnt.value = "#609955";
            localStorage.setItem("cmnt",cmnt.value);
            document.documentElement.style.setProperty('--comments', cmnt.value);



        })


        document.getElementById('sym-col-reset').addEventListener("click", () => {


            let rgbVal = getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim();



            if(rgbVal === "#ffffff"){

                rgbVal = "#839496";

            }



            if(localStorage.getItem("lightMode") === "active"){
                rgbVal = "#383838";
            }
            else{

                rgbVal = "#839496";

            }

            symbol.value = rgbVal;
            localStorage.setItem("symbol",symbol.value);
            document.documentElement.style.setProperty('--symbols', symbol.value);


            
        })

        modal.addEventListener("click", (e) => {
            const rect = modal.getBoundingClientRect();
            const setting_ui_elms = ["dropdown-panel", "font-optn", "switch", "repl-node", "color-picker-btn", "settings-footer-btn"];

            const inside = (
                e.clientX >= rect.left &&
                e.clientX <= rect.right &&
                e.clientY >= rect.top &&
                e.clientY <= rect.bottom
            ) || setting_ui_elms.some(cls =>
            e.target.closest(`.${cls}`)
            );

            if (!inside) modal.close();
        });

        document.getElementById('close-settings').addEventListener("click", () => {

            

            modal.close();

        })

        document.getElementById('apr-tgl').addEventListener("click", () => {


            document.getElementById('settings-container').style.display = "none";
            document.getElementById('appearance-settings').style.display = "flex";
            document.getElementById('stng-mdl-ttl').textContent = "Appearance";

        })

        document.getElementById('exit-apr-panel').addEventListener("click", () => {

            document.getElementById('settings-container').style.display = "flex";
            document.getElementById('appearance-settings').style.display = "none";
            document.getElementById('stng-mdl-ttl').textContent = "Settings";
            document.getElementById('settings-modal').showModal();
            

        })

        document.getElementById('reset-settings').addEventListener("click", function() {

            if(confirm("Are you sure want to reset all settings? (This will also reset all appearance settings)")){
                if(!Ln_toggle.checked){

                    Ln_toggle.click();

                }

                if(!Lw_toggle.checked){

                    Lw_toggle.click();

                }

                if(!Ac_toggle.checked){

                    Ac_toggle.click();

                }

                if(!dpf_toggle.checked){

                    dpf_toggle.click();

                }

                if(!Af_toggle.checked){

                    Af_toggle.click();

                }

                if(!Lg_toggle.checked){

                    Lg_toggle.click();

                }

                if(!Mmp_toggle.checked){

                    Mmp_toggle.click();   

                }

                if(flmd_toggle.checked){

                    flmd_toggle.click();

                }

                document.getElementById('keyword-col-reset').click();
                document.getElementById('other-col-reset').click();
                document.getElementById('dt-col-reset').click();
                document.getElementById('ident-col-reset').click();
                document.getElementById('const-col-reset').click();
                document.getElementById('fn-col-reset').click();
                document.getElementById('string-col-reset').click();
                document.getElementById('char-col-reset').click();
                document.getElementById('num-col-reset').click();
                document.getElementById('cmnt-col-reset').click();
                document.getElementById('sym-col-reset').click();
                document.getElementById('bool-col-reset').click();
                document.getElementById('op-col-reset').click();

                font_size.value = 13;
                font_size.dispatchEvent(new Event('change', {bubbles: true}));

                font_selection.value = "courier-optn"
                document.documentElement.style.setProperty("--editor-font-fam", "'Courier New', Courier, monospace");


               
                document.getElementById('repl-nodes').value = "program";
            }


            

        })

        document.getElementById('save-preset').addEventListener("click", function() {


            const settings = {

                origin: "native",
                Ln: Ln_toggle.checked,
                Lw: Lw_toggle.checked,
                Ac: Ac_toggle.checked,
                Dpf: dpf_toggle.checked,
                Lg: Lg_toggle.checked,
                Af: Af_toggle.checked,
                Mmp: Mmp_toggle.checked,
                Flmd: flmd_toggle.checked,
                Kw: keyword.value,
                Ctrl: other.value,
                Dt: datatype.value,
                Id: identifier.value,
                Cns: constant.value,
                Op: operator.value,
                Bool: bool.value,
                Fn: fn.value,
                Str: str.value,
                Char: char.value,
                Num: num.value,
                Cmnt: cmnt.value,
                Fs: font_size.value,
                Sym: symbol.value,
                Ff: localStorage.getItem('font-fam'),
                Out: localStorage.getItem('output-mode')

            }

            const txt = JSON.stringify(settings);



            saveJSONFile("my_preset", txt);


        })

        function ChangeColourSafely(object, reference){

            if(reference && reference.startsWith('#') && reference.length == 7){

                object.value = reference;

            }

            return null;
            
        }

        function loadPreset(p) {

            if(p.origin || p.Ff){
                
                if(Ln_toggle.checked != p.Ln){

                    Ln_toggle.click();

                }

                if(Lw_toggle.checked != p.Lw){

                    Lw_toggle.click();

                }

                if(Ac_toggle.checked != p.Ac){

                    Ac_toggle.click();

                }

                if(dpf_toggle.checked != p.Dpf){

                    dpf_toggle.click();

                }

                if(Af_toggle.checked != p.Af){

                    Af_toggle.click();

                }

                if(Mmp_toggle.checked != p.Mmp){

                    Mmp_toggle.click();

                }

                if(Lg_toggle.checked != p.Lg){

                    Lg_toggle.click();

                }

                if(Mmp_toggle.checked != p.Mmp){

                    Mmp_toggle.click();

                }

                if(flmd_toggle.checked != p.Flmd){

                    flmd_toggle.click();

                }



                {

                    ChangeColourSafely(keyword, p.Kw);
                    localStorage.setItem("keyword", keyword.value);
                    document.documentElement.style.setProperty('--keyword', keyword.value);

                    ChangeColourSafely(other, p.Ctrl);
                    localStorage.setItem("other", other.value);
                    document.documentElement.style.setProperty('--other', other.value);

                    ChangeColourSafely(datatype, p.Dt);
                    localStorage.setItem("datatype", datatype.value);
                    document.documentElement.style.setProperty('--datatype', datatype.value);

                    ChangeColourSafely(identifier, p.Id);
                    localStorage.setItem("identifier", identifier.value);
                    document.documentElement.style.setProperty('--variable', identifier.value);

                    ChangeColourSafely(constant, p.Cns);
                    localStorage.setItem("constant", constant.value);
                    document.documentElement.style.setProperty('--constant', constant.value);

                    ChangeColourSafely(fn, p.Fn);
                    localStorage.setItem("fn", fn.value);
                    document.documentElement.style.setProperty('--native', fn.value);

                    ChangeColourSafely(str, p.Str);
                    localStorage.setItem("str", str.value);
                    document.documentElement.style.setProperty('--string', str.value);

                    ChangeColourSafely(bool, p.Bool);
                    localStorage.setItem("bool", bool.value);
                    document.documentElement.style.setProperty('--boolean', bool.value);

                    ChangeColourSafely(operator, p.Op);
                    localStorage.setItem("operator", operator.value);
                    document.documentElement.style.setProperty('--operator', operator.value);

                    ChangeColourSafely(char, p.Char);
                    localStorage.setItem("char", char.value);
                    document.documentElement.style.setProperty('--char', char.value);

                    ChangeColourSafely(num, p.Num);
                    localStorage.setItem("num", num.value);
                    document.documentElement.style.setProperty('--number', num.value);

                    ChangeColourSafely(cmnt, p.Cmnt);
                    localStorage.setItem("cmnt", cmnt.value);
                    document.documentElement.style.setProperty('--comments', cmnt.value);

                    if(p.Sym){
                        ChangeColourSafely(symbol, p.Sym);
                    
                        localStorage.setItem("symbol", symbol.value);
                        document.documentElement.style.setProperty('--symbols', symbol.value);
                    }

                    


                    font_size.value = p.Fs;
                    font_size.dispatchEvent(new Event('change', {bubbles: true}));
                }


                document.documentElement.style.setProperty("--editor-font-fam", p.Ff);

                if(p.Ff.startsWith('cascadia')) font_selection.value = "cascadia-optn";
                else if(p.Ff.startsWith('consolas')) font_selection.value = "consolas-optn";
                else if(p.Ff.startsWith('sans-serif')) font_selection.value = "sans-serif-optn";
                else if(p.Ff.startsWith('monospace')) font_selection.value = "monospace-optn";
                else if(p.Ff.startsWith("'jetbrains")) font_selection.value = "jetbrains-mono-optn";
                else if(p.Ff.startsWith("brass")) font_selection.value = "brass-mono-optn"
                else if(p.Ff.startsWith("kode")) font_selection.value = "kode-mono-optn"
                else font_selection.value = "courier-optn";

                
                

                if(p.Out == "tokenise"){

                    localStorage.setItem("output-mode", "tokens");
                    output_modes.value = "tokens";
                }
                else if(p.Out == "ast"){

                    localStorage.setItem("output-mode", "ast");
                    output_modes.value = "ast";

                }
                else if(p.Out == "python"){

                    localStorage.setItem("output-mode", "python");
                    output_modes.value = "python";

                }
                else{

                    localStorage.setItem("output-mode", "evaluate");
                    output_modes.value = "program";

                }

            }
            else if(p.tokenColors){

                //Parse foreign theme files

                p.tokenColors.forEach(token => {
   
                    const scopes = Array.isArray(token.scope) ? token.scope : [token.scope];

                    
                });

                
                ChangeColourSafely(keyword, p.tokenColors.filter(i => i.scope.includes("keyword"))[0]?.settings?.foreground);
                localStorage.setItem("keyword", keyword.value);
                document.documentElement.style.setProperty('--keyword', keyword.value);

                
                ChangeColourSafely(other, p.tokenColors.filter(i => i.scope.includes("keyword.control"))[0]?.settings?.foreground);
                localStorage.setItem("other", other.value);
                document.documentElement.style.setProperty('--other', other.value);

                ChangeColourSafely(datatype, p.tokenColors.filter(i => i.scope.includes("entity.name.type"))[0]?.settings?.foreground);
                localStorage.setItem("datatype", datatype.value);
                document.documentElement.style.setProperty('--datatype', datatype.value);

                
                ChangeColourSafely(identifier, p.tokenColors.filter(i => i.scope.includes("variable"))[0]?.settings?.foreground);
                localStorage.setItem("identifier", identifier.value);
                document.documentElement.style.setProperty('--variable', identifier.value);

                
                ChangeColourSafely(constant,p.tokenColors.filter(i => i.scope.includes("constant"))[0]?.settings?.foreground )
                localStorage.setItem("constant", constant.value);
                document.documentElement.style.setProperty('--constant', constant.value);

    
                ChangeColourSafely(fn, p.tokenColors.filter(i => i.scope.includes("variable.function") || i.scope.includes("entity.name.function"))[0]?.settings?.foreground)
                localStorage.setItem("fn", fn.value);
                document.documentElement.style.setProperty('--native', fn.value);

                
                ChangeColourSafely(str, p.tokenColors.filter(i => i.scope.includes("string.quoted"))[0]?.settings?.foreground);
                localStorage.setItem("str", str.value);
                document.documentElement.style.setProperty('--string', str.value);

                
                ChangeColourSafely(bool, p.tokenColors.filter(i => i.scope.includes("constant.language"))[0]?.settings?.foreground);
                localStorage.setItem("bool", bool.value);
                document.documentElement.style.setProperty('--boolean', bool.value);

                
                ChangeColourSafely(operator,p.tokenColors.filter(i => i.scope.includes("keyword.operator"))[0]?.settings?.foreground);
                localStorage.setItem("operator", operator.value);
                document.documentElement.style.setProperty('--operator', operator.value);

                
                ChangeColourSafely(char, p.tokenColors.filter(i => i.scope.includes("string.quoted"))[0]?.settings?.foreground);
                localStorage.setItem("char", char.value);
                document.documentElement.style.setProperty('--char', char.value);


                ChangeColourSafely(num, p.tokenColors.filter(i => i.scope.includes("constant.numeric"))[0]?.settings?.foreground);
                if(p.tokenColors.filter(i => i.scope.includes("constant.numeric")).length == 0) num.value = p.tokenColors.filter(i => i.scope.includes("constant.language"))[0]?.settings?.foreground;
                localStorage.setItem("num", num.value);
                document.documentElement.style.setProperty('--number', num.value);

                
                ChangeColourSafely(cmnt, p.tokenColors.filter(i => i.scope.includes("comment"))[0]?.settings?.foreground);
                localStorage.setItem("cmnt", cmnt.value);
                document.documentElement.style.setProperty('--comments', cmnt.value);

                if(p.Sym){

                    ChangeColourSafely(symbol, p.tokenColors.filter(i => i.scope.includes("punctuation.separator.key-value"))[0]?.settings?.foreground)
                    localStorage.setItem("symbol", symbol.value);
                    document.documentElement.style.setProperty('--symbols', symbol.value);
                }

            }
            else{

                alert("The file uploaded was not a valid theme file");

            }
            

        }

        document.getElementById('upload-preset').addEventListener('click', () => {

            function openFile() {
                window.showOpenFilePicker({
                    types: [{
                        description: 'JSON files',
                        accept: {
                            'text/plain': ['.txt','.json']
                        }
                    }],
                    excludeAcceptAllOption: true,
                    multiple: false,
                })
                .then(([fileHandle]) => {
                    // Save the handle if you want to write later
                    return fileHandle.getFile().then(file => ({
                        content: file.text(),
                        name: file.name
                    }));
                })
                .then(async ({ content, name }) => {

                    try {
                        const preset = JSON.parse(await content);
                        loadPreset(preset);
                    } catch (error) {
                        alert("Invalid file uploaded!");
                    }

                     // Resolve the file text
                    
                    

                    


                })
                .catch(error => {
                    console.error("File picking failed:", error);
                });
            }
            
            openFile();

            if(!modal.open){

                modal.show();

            }
            

        })
        

        const scrollBar = document.getElementById('mini-map-scroll');
        const scrollCont = document.getElementById('minimap-vertical-wrapper');
        const scrollCollumn = document.getElementById('mini-map-collumn');
        const scrollUsed = document.getElementById('mini-map-content');
        const padding_bottom = 0;
        let scrollRatio = 0;

        const paren = document.querySelector('.CodeMirror');
        const main = document.getElementsByClassName("CodeMirror-vscrollbar")[0];

        let isDragging = false;
        let startY = 0;
        let startTop = 0;


        scrollBar.style.touchAction = 'none';


        scrollBar.addEventListener('pointerdown', (e) => {
            isDragging = true;
            startY = e.clientY;
            startTop = scrollBar.offsetTop;

            scrollBar.setPointerCapture(e.pointerId);

            e.preventDefault(); 
        });


        scrollBar.addEventListener('pointermove', (e) => {
            if (!isDragging) return;

            const deltaY = e.clientY - startY;


            const height = parseFloat(getComputedStyle(scrollUsed).height);
            const barHeight = parseFloat(getComputedStyle(scrollBar).height);
            const maxHeight = parseFloat(getComputedStyle(scrollCont).height) - barHeight - 1;

            let totalDistance = height - barHeight;
            if (totalDistance > maxHeight) totalDistance = maxHeight;


            let newTop = startTop + deltaY;
            newTop = Math.max(0, Math.min(newTop, totalDistance));


            scrollBar.style.top = `${newTop}px`;


            const scrollRatio = newTop / totalDistance;
            scrollUsed.scrollTop = scrollRatio * (scrollUsed.scrollHeight - scrollUsed.clientHeight);
            main.scrollTop = scrollRatio * (main.scrollHeight - main.clientHeight);

            last_scroll_height = height;
        });


        scrollBar.addEventListener('pointerup', (e) => {
            isDragging = false;
            scrollBar.releasePointerCapture(e.pointerId);
        });


        main.addEventListener("scroll", () => {


            const range = main.scrollHeight - main.clientHeight;

            const mainRatio = main.scrollTop / range;

            { 
                const contRange = scrollUsed.scrollHeight - scrollUsed.clientHeight;

                scrollUsed.scrollTop = mainRatio * contRange;
        
            } //Mini-map

            {
                const height = parseFloat(getComputedStyle(scrollUsed).height.slice(0,-2));
                
                const barHeight = parseFloat(getComputedStyle(scrollBar).height.slice(0,-2));

               

                const maxHeight = parseFloat(getComputedStyle(scrollCont).height.slice(0,-2)) - barHeight - 1;

                let totalDistance = height - barHeight;


                if(totalDistance > maxHeight){

                    totalDistance = maxHeight;

                }

                const newTop = totalDistance * mainRatio;

                


                scrollBar.style.top = newTop + 'px';

            } //Scroll bar

            last_scroll_height = parseFloat(getComputedStyle(scrollUsed).height.slice(0,-2));

        })

        document.getElementById('mini-map-collumn').addEventListener("mouseover", (e) => {


            const thumb = document.getElementById('mini-map-scroll');

            if(e.target == thumb){

                thumb.style.opacity = '0.1';

            }
            else{

                thumb.style.opacity = '0.05';

            }
            

        })

        document.getElementById('mini-map-collumn').addEventListener("mouseleave", () => {


            const thumb = document.getElementById('mini-map-scroll');

            thumb.style.opacity = '0';
            

        })

        document.getElementById('mini-map-scroll').style.opacity = '0';
        
        const wheelEvent = new WheelEvent('wheel', {
            deltaY: -50,      
            bubbles: true,   
            cancelable: true
        });

        document.addEventListener("click", function(e) {
            const thumb = document.getElementById('mini-map-scroll');

            if (getComputedStyle(thumb).opacity === '0.05') {

 
                const start = parseFloat(getComputedStyle(scrollBar).top.slice(0, -2));

 
                const mouseY = e.clientY;
                const barY = scrollBar.getBoundingClientRect().top;
                const barH = parseFloat(getComputedStyle(scrollBar).height.slice(0, -2)) / 2;

                const height = parseFloat(getComputedStyle(scrollUsed).height.slice(0, -2));
                const scrollContHeight = parseFloat(getComputedStyle(scrollCont).height.slice(0, -2));
                const barHeight = parseFloat(getComputedStyle(scrollBar).height.slice(0, -2));

                let maxHeight = scrollContHeight - barHeight - 1;
                let totalDistance = height - barHeight;

                if (totalDistance > maxHeight) {
                totalDistance = maxHeight; 
                }


                let absDistance = Math.abs(mouseY - barY) - barH;
                let inch = absDistance;


                if (mouseY < barY) inch = -inch;


                let newTop = start + inch;


                newTop = Math.max(0, Math.min(newTop, totalDistance));

    
                scrollBar.style.top = `${newTop}px`;


                const mainRatio = newTop / totalDistance;
                const contRange = scrollCont.scrollHeight - scrollCont.clientHeight;
                scrollCont.scrollTop = mainRatio * contRange;
                main.scrollTop = mainRatio * (main.scrollHeight - main.clientHeight);
            }
        

        
        });



        function getLineDOM(cm, line) {
            const info = cm.lineInfo(line);

            return info ?? null;
        }


        let lastLine = null;
        let lastLineNode = null;

        function isLineFolded(editor, lineNumber) {
            const lineStart = { line: lineNumber, ch: 0 };
            const lineEnd = { line: lineNumber + 1, ch: 0 };
            
            return editor.findMarks(lineStart, lineEnd).some(mark => mark.collapsed);
        }

        let globalLineNum = 0;

        editor.on("mousedown", (cm, event) => {
            const lineNode = event.target.closest(".CodeMirror-line");
            if (!lineNode) return;

            const widget = lineNode.querySelector(".CodeMirror-foldmarker");
            if (!widget) return;

            const rect = widget.getBoundingClientRect();


            if (event.clientX <= rect.right) return;

            event.preventDefault();
            event.stopPropagation();


            const pos = cm.coordsChar(
                { left: event.clientX, top: event.clientY },
                "window"
            );


            const marks = cm.findMarksAt(pos);
            const fold = marks.find(m => m.__isFold);

            if (!fold) return;

            const range = fold.find();
            if (!range) return;

            cm.setCursor(range.from);
        });



        editor.on("cursorActivity", cm => {
            


            const line = cm.getCursor().line;

            globalLineNum = line;

            if (line !== lastLine) {
                lastLine = line;

                if(lastLineNode){ 
                    editor.removeLineClass(lastLineNode.line, 'text', 'cm-line-active');
                    editor.removeLineClass(lastLineNode.line, 'text', 'cm-fold-line-active');
                } 

                lastLineNode = getLineDOM(cm, line);



                if(isLineFolded(editor, line)) editor.addLineClass(lastLineNode.line, "text", 'cm-fold-line-active');
                else editor.addLineClass(lastLineNode.line, 'text', 'cm-line-active');
            }
        });

        function getAllFoldRanges(cm) {
            return cm.getAllMarks()
                .filter(m => m.collapsed)
                .map(m => m.find())
                .filter(Boolean);
        }


        function findParentLine(cm, line){

            const all = getAllFoldRanges(cm);

            const potentials = all.filter(range => range.from.line <= line && line <= range.to.line);

            const parentRange = potentials.reduce((closest, range) => (range.to.line - range.from.line) < (closest.to.line - closest.from.line) ? range : closest, potentials[0]);

            if(parentRange && parentRange.from) return parentRange.from.line;
            else return null;

        }


        editor.on('gutterClick', (cm, line, gutter, event) => {


            if (gutter === 'CodeMirror-foldgutter') {

                const node = getLineDOM(cm, line);

                

                if (event.target.closest('.CodeMirror-foldgutter-open')){ 
                    
                    

                    if(node && node.gutterMarkers && node.gutterMarkers['CodeMirror-foldgutter']){
                        
                        const pLine = findParentLine(cm, globalLineNum);

                        if(pLine) cm.setCursor(pLine, 0);
                        editor.addLineClass(line, 'wrap', 'cm-line-folded');
                        
                        if(editor.getCursor().line == node.line){

                            editor.removeLineClass(line, 'text', 'cm-line-active');
                            editor.addLineClass(line, 'text', 'cm-fold-line-active');


                        }

                    }
 
                }
                else if (event.target.closest('.CodeMirror-foldgutter-folded')) {
                    editor.removeLineClass(line, 'wrap', 'cm-line-folded');

                    if(editor.getCursor().line == node.line){

                        editor.addLineClass(line, 'text', 'cm-line-active');
                        editor.removeLineClass(line, 'text', 'cm-fold-line-active');


                    }
                }
            }
        });


        function getY(element){

            const rect = element.getBoundingClientRect();
            const y = rect.top;

            return y;

        }

        function setY(element, y){

            const rect = element.getBoundingClientRect();
            rect.top = y;

            return y;

        }

       

        if(!localStorage.getItem('Mmp') || localStorage.getItem('Mmp') == "true"){

            if(!localStorage.getItem('Mmp')){

                localStorage.setItem("Mmp","true");

            }

            if(selectedTab.endsWith('.pseudo')){
                document.getElementById('mini-map-content').style.whiteSpace = 'normal';
                build_map(editor.getValue(), selectedTab.endsWith('.txt'));
                
                setTimeout(() => {


                    build_map(editor.getValue(), selectedTab.endsWith('.txt'));

                }, 1000);


            }
            else{


                document.getElementById('mini-map-content').style.whiteSpace = 'pre';
                document.getElementById('mini-map-content').innerHTML = editor.getValue();

            }

            

        }

        last_scroll_height = parseFloat(getComputedStyle(scrollUsed).height.slice(0,-2));





        function getDefault(){



            fetch('/Prewritten/Default.txt')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.text(); // Use .json() if it's JSON
                    })
                    .then(data => {

                        if(data){

                            return data;
                        }
                        else{

                            return "error";

                        }
                        
                        
                    })
                    .catch(error => {
                        console.error("Error fetching file:", error);
                    });


        }

        function loadDefault(){
            fetch('/Prewritten/Default.txt')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.text(); // Use .json() if it's JSON
                    })
                    .then(data => {

                        if(!localStorage.getItem("Default")){

                            localStorage.setItem("Default", data);

                            editor.setValue(data);

                        }
                        
                    })
                    .catch(error => {
                        console.error("Error fetching file:", error);
                    });


        }

        
        
        function highlightActiveLineNumber() {



            const pos = editor.getCursor(); // current cursor (works for clicks or selection changes)

            const parent = document.getElementsByClassName('CodeMirror-code')[0];
            const allLines = Array.from(parent.getElementsByClassName('CodeMirror-linenumber'));

            let ln_num = pos.line + 1;

            for (const line of allLines) {

                if(line.innerHTML === `${ln_num}`){

   
                    line.classList.add('cm-ln-active');

                }
                else{
                    line.classList.remove('cm-ln-active');
                }


            }

        }


        editor.getWrapperElement().addEventListener("click", (e) => {

            
            
            const ln_classes = [
                'CodeMirror-gutter CodeMirror-linenumbers',
                'CodeMirror-gutter CodeMirror-foldgutter'
            ];

            if (!ln_classes.includes(e.target.className)) {
                highlightActiveLineNumber();
            }
        });


        editor.on("cursorActivity", () => {
            setTimeout(highlightActiveLineNumber, 0);
        });


        setTimeout(highlightActiveLineNumber, 0);

        const share = document.getElementById('share-btn');



        const compressedCode = LZString.compressToEncodedURIComponent(editor.getValue());
        let shareURL = `${window.location.origin}?name=${selectedTab}&code=${compressedCode}`;
        document.getElementById('share-link').innerHTML = shareURL;

        if(share){
            share.addEventListener("click", () => {

                
                document.getElementById('pre-gen').style.display = "flex";
                document.getElementById('gen').style.display = "none";

                

                const p_name = document.getElementById('project-name');

                p_name.value = selectedTab == "Main.pseudo" ? "MyProject.pseudo" : selectedTab;;
                p_name.select();
                p_name.setSelectionRange(0, 99999); // For mobile devices

                document.getElementById('share-modal').showModal();

            });
        }

        let share_event;

        document.getElementById('gen-btn').addEventListener("click", () => {

            const name = adapt_file_name(document.getElementById('project-name').value);

            if(name.trim() === ".txt" || name.trim() === "" || name.trim() === ".pseudo"){

                alert("Please enter a valid project name.");

                return;

            }
            
            else if(name == "Main.pseudo" || name == "Sample.txt"){
                
                alert(`Cannot use the name "${name}" as it is a Pseudowhizz default file name. Please try a different name.`);

                return;



            }
            else{


                const name = adapt_file_name(document.getElementById('project-name').value);
                const compressedCode = LZString.compressToEncodedURIComponent(editor.getValue());
                shareURL = `${window.location.origin}?name=${name}&code=${compressedCode}`;



                document.getElementById('share-link').innerHTML = shareURL;

                

                document.getElementById('share-msg').innerHTML = name; 

                document.getElementById('pre-gen').style.display = "none";



                document.getElementById('gen').style.display = "flex";

                share_event = function(){

                    navigator.share({
                        title: name,
                        text: `Check out my project: "${name}" on Pseudowhizz!`,
                        url: shareURL,
                    });

                }

                document.getElementById('share-more').addEventListener("click", share_event);

            }


            



        })

        document.getElementById('copy-link').addEventListener("click", () => {



            navigator.clipboard.writeText(shareURL).then(() => {
                alert("Link copied to clipboard!");
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });

        })



        window.addEventListener("DOMContentLoaded", () => {
            const params = new URLSearchParams(window.location.search);
            const name = params.get("name");
            const compressedCode = params.get("code");


           


            if (name && compressedCode) {

                const code = LZString.decompressFromEncodedURIComponent(compressedCode);

                if (name !== null && code !== null) {

                    createNewFile(name, code);
                    editor.setValue(code);
                }
            }
        });


        document.getElementById('project-name').value = selectedTab;

        document.getElementById('python-btn').addEventListener("click", () => {

            alert("Console will now output python translation");
            document.getElementById('repl-nodes').value = "python";
            repl_request = "python";
            localStorage.setItem('output-mode', 'python');

        })

        document.getElementById('ast-btn').addEventListener("click", () => {

            alert("Console will now output program abstract syntax tree");
            document.getElementById('repl-nodes').value = "ast";
            repl_request = "ast"
            localStorage.setItem('output-mode', 'ast');

        })

        document.getElementById('tokens-btn').addEventListener("click", () => {

            alert("Console will now output tokenised program");
            document.getElementById('repl-nodes').value = "tokens";
            repl_request = "tokens";
            localStorage.setItem('output-mode', 'tokens');

        })

        document.getElementById('js-btn').addEventListener("click", () => {

            alert("Javascript translator coming soon!");

        });


        function onSelectionChange(editor, callback) {
            let lastSelections = null;

            editor.on("cursorActivity", () => {

                const selections = editor.listSelections().map(sel => {
                const from = CodeMirror.cmpPos(sel.anchor, sel.head) <= 0
                    ? sel.anchor
                    : sel.head;

                const to = CodeMirror.cmpPos(sel.anchor, sel.head) <= 0
                    ? sel.head
                    : sel.anchor;

                    return {
                        text: editor.getRange(from, to),
                        from,
                        to
                    };
                });

                // Prevent duplicate firing
                const serialized = JSON.stringify(selections);
                if (serialized === lastSelections) return;
                lastSelections = serialized;

                callback(selections);
            });
        }


        onSelectionChange(editor, selections => {


            const sel = editor.getSelection(); 
            const from = editor.getCursor("from"); 
            const to = editor.getCursor("to"); 
            const numLines = to.line - from.line + 1; 



            const firstNode = getLineDOM(editor, selections[0].from.line);
            const lastNode = getLineDOM(editor, selections[0].to.line);

            
            if(numLines > 1 || editor.getSelection().length > 0){ 
                editor.removeLineClass(firstNode.line, 'text', 'cm-line-active');
                editor.removeLineClass(lastNode.line, 'text', 'cm-line-active');
            }
            else if(numLines == 1) editor.addLineClass(firstNode.line, 'text', 'cm-line-active');


            select_all(editor, selections[0]);
        });

        function lineHasFoldWgt(cm, line) {
            const lineNode = cm.getLineHandle(line)?.widgets || [];
            return lineNode.some(widget => widget.node?.classList?.contains("CodeMirror-foldmarker"));
        }


        editor.on("mousedown", (cm, event) => {

            const marker = event.target.closest(".CodeMirror-foldmarker");
            if (!marker) return;

            cm.removeLineClass(lastLineNode.line, 'text', 'cm-fold-line-active');
            cm.removeLineClass(lastLineNode.line, 'wrap', 'cm-line-folded');

        });

        

        editor.refresh();

        function openGmailCompose(to) {
            const url ="https://mail.google.com/mail/?view=cm&fs=1&to=" + encodeURIComponent(to);

            window.open(url, "_blank");
        }

        document.getElementById('mailIcon').addEventListener('click', () => {
            openGmailCompose('pseudowhizz@gmail.com');
        });

        /*const cnsl_resizer = document.getElementById('console-resizer');

        const MIN_Y = 120;
        const MAX_Y = 420;

        let startY1 = 0;
        let startTop2 = 0;
        let activePointerId = null;

        cnsl_resizer.addEventListener("pointerdown", (e) => {
            activePointerId = e.pointerId;
            cnsl_resizer.setPointerCapture(e.pointerId);
            
            startY1 = e.clientY;
            startTop2 = cnsl_resizer.offsetTop;
        });

        cnsl_resizer.addEventListener("pointermove", (e) => {
            
            

            if (e.pointerId !== activePointerId) return;

            



            let newTop = startTop2 + (e.clientY - startY1);
            newTop = Math.max(MIN_Y, Math.min(MAX_Y, newTop));

            console.log(newTop);

            //cnsl_resizer.style.top = `${newTop}px`;

            const deltaHeight = MAX_Y - parseInt(cnsl_resizer.style.top.slice(0,-2));
            const inverseDelta = parseInt(cnsl_resizer.style.top.slice(0,-2)) - cnsl_resizer.clientHeight;

            const height = 150 * (deltaHeight / (MAX_Y - MIN_Y));
            
            const editorHeight = inverseDelta /  420;


            
        });

        cnsl_resizer.addEventListener("pointerup", release);
        cnsl_resizer.addEventListener("pointercancel", release);

        function release(e) {
            if (e.pointerId !== activePointerId) return;
            cnsl_resizer.releasePointerCapture(e.pointerId);
            activePointerId = null;
        }*/



    </script>


    
</body>
</html>